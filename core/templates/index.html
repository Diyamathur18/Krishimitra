<!DOCTYPE html>
<html lang="hi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>üåæ ‡§ï‡•É‡§∑‡§ø‡§Æ‡§ø‡§§‡•ç‡§∞ AI - ‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç ‡§ï‡§æ ‡§∏‡§¨‡§∏‡•á ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§¶‡•ã‡§∏‡•ç‡§§ - v2.1</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        }

        .navbar-brand {
            font-weight: bold;
            color: #2d5016 !important;
            font-size: 1.5rem;
        }

        .hero-section {
            background: linear-gradient(135deg, #2d5016 0%, #4a7c59 100%);
            color: white;
            padding: 60px 0;
            text-align: center;
        }

        .hero-title {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .hero-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        /* Location Search Styles */
        .location-search-container {
            max-width: 600px;
            margin: 30px auto;
            position: relative;
        }

        .search-box {
            display: flex;
            align-items: center;
            background: white;
            border-radius: 50px;
            padding: 10px 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .search-box:focus-within {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.3);
        }

        .search-box i {
            color: #4a7c59;
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .search-box input {
            flex: 1;
            border: none;
            outline: none;
            font-size: 1.1rem;
            padding: 10px;
            color: #333;
        }

        .search-box input::placeholder {
            color: #999;
        }

        .search-box .btn {
            border-radius: 50px;
            padding: 8px 15px;
            margin-left: 10px;
        }

        .location-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }

        .location-suggestion {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .location-suggestion:hover {
            background: #f8f9fa;
            color: #4a7c59;
        }

        .location-suggestion:last-child {
            border-bottom: none;
        }

        .suggestion-name {
            font-weight: 600;
            color: #333;
        }

        .suggestion-details {
            font-size: 0.9rem;
            color: #666;
        }

        .current-location-display {
            margin-top: 20px;
            padding: 15px 25px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            display: inline-flex;
            align-items: center;
            gap: 15px;
            backdrop-filter: blur(10px);
        }

        .location-label {
            font-weight: 600;
        }

        .location-name {
            font-weight: 700;
            font-size: 1.1rem;
        }

        /* Crop Search Styles */
        .crop-search-container {
            max-width: 600px;
            margin: 0 auto;
            position: relative;
        }

        .crop-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }

        .crop-suggestion {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .crop-suggestion:hover {
            background: #f8f9fa;
            color: #4a7c59;
        }

        .crop-suggestion:last-child {
            border-bottom: none;
        }

        .crop-suggestion-name {
            font-weight: 600;
            color: #333;
        }

        .crop-suggestion-details {
            font-size: 0.9rem;
            color: #666;
        }

        /* Crop Analysis Styles */
        .crop-analysis-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .crop-analysis-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #4a7c59;
        }

        .crop-analysis-card h5 {
            color: #2c5530;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }

        .analysis-item {
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 0.95rem;
        }

        .analysis-item:last-child {
            border-bottom: none;
        }

        .analysis-item strong {
            color: #4a7c59;
            font-weight: 600;
        }

        /* Crops Grid Layout */
        .crops-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .crop-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #4a7c59;
            transition: all 0.3s ease;
            min-height: 400px;
            display: flex;
            flex-direction: column;
        }

        .crop-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .crop-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .crop-header h5 {
            color: #2c5530;
            font-size: 1.3rem;
            font-weight: 700;
            margin: 0;
        }

        .crop-rank {
            background: #4a7c59;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .profitability-score {
            background: #e8f5e8;
            color: #2c5530;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .crop-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .crop-info {
            margin-bottom: 15px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 600;
            color: #4a7c59;
            font-size: 0.95rem;
        }

        .info-value {
            font-weight: 500;
            color: #333;
            font-size: 0.95rem;
            text-align: right;
        }

        .crop-scores {
            margin-top: auto;
            padding-top: 15px;
            border-top: 2px solid #f0f0f0;
        }

        .score-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
        }

        .score-label {
            font-weight: 600;
            color: #4a7c59;
            font-size: 0.9rem;
        }

        .score-value {
            font-weight: 500;
            color: #333;
            font-size: 0.9rem;
        }

        /* Universal Service Card Styles */
        .service-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .service-card-item {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #4a7c59;
            transition: all 0.3s ease;
            min-height: 350px;
            display: flex;
            flex-direction: column;
        }

        .service-card-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .service-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .service-card-header h5 {
            color: #2c5530;
            font-size: 1.2rem;
            font-weight: 700;
            margin: 0;
        }

        .service-card-badge {
            background: #4a7c59;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .service-card-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .service-card-info {
            margin-bottom: 15px;
        }

        .service-info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .service-info-item:last-child {
            border-bottom: none;
        }

        .service-info-label {
            font-weight: 600;
            color: #4a7c59;
            font-size: 0.95rem;
        }

        .service-info-value {
            font-weight: 500;
            color: #333;
            font-size: 0.95rem;
            text-align: right;
        }

        .service-card-actions {
            margin-top: auto;
            padding-top: 15px;
            border-top: 2px solid #f0f0f0;
        }

        .service-action-btn {
            background: #4a7c59;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 8px;
        }

        .service-action-btn:hover {
            background: #2c5530;
            transform: translateY(-2px);
        }

        .service-action-btn.secondary {
            background: #e8f5e8;
            color: #2c5530;
        }

        .service-action-btn.secondary:hover {
            background: #d4edda;
        }

        /* Mandi Search Styles */
        .mandi-search-container {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #dee2e6;
        }

        .mandi-search-container h5 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
        }

        .search-boxes-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .search-box {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .search-box label {
            display: block;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .mandi-search-box,
        .crop-search-box {
            display: flex;
            gap: 10px;
        }

        .mandi-search-box input,
        .crop-search-box input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .mandi-search-box input:focus,
        .crop-search-box input:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }

        .mandi-search-box button {
            padding: 12px 20px;
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .crop-search-box button {
            padding: 12px 20px;
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mandi-search-box button:hover {
            background: linear-gradient(135deg, #0056b3 0%, #004085 100%);
            transform: translateY(-1px);
        }

        .crop-search-box button:hover {
            background: linear-gradient(135deg, #1e7e34 0%, #155724 100%);
            transform: translateY(-1px);
        }

        /* Mandi Dropdown and Crop Filter Styles */
        .mandi-selection-container {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .mandi-dropdown-container,
        .crop-filter-container {
            flex: 1;
            min-width: 250px;
        }

        .mandi-dropdown-container label,
        .crop-filter-container label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }

        .mandi-dropdown {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            background-color: white;
            transition: border-color 0.3s ease;
        }

        .mandi-dropdown:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }

        .mandi-info-text {
            margin-top: 5px;
        }

        .mandi-info-text small {
            color: #6c757d;
            font-size: 12px;
        }

        #cropFilter {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        #cropFilter:focus {
            border-color: #28a745;
            outline: none;
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
        }

        /* Mandi Prices Grid - Square Boxes */
        .mandi-prices-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .mandi-price-square {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .mandi-price-square:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .square-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f8f9fa;
        }

        .square-header h6 {
            color: #2c3e50;
            font-weight: 600;
            margin: 0;
            font-size: 16px;
        }

        .trend-icon {
            font-size: 18px;
        }

        .square-content {
            text-align: center;
        }

        .price-main {
            margin-bottom: 15px;
        }

        .current-price {
            font-size: 24px;
            font-weight: 700;
            color: #28a745;
        }

        .price-unit {
            font-size: 14px;
            color: #6c757d;
            margin-left: 5px;
        }

        .price-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
        }

        .detail-row .label {
            font-size: 12px;
            color: #6c757d;
            font-weight: 500;
        }

        .detail-row .value {
            font-size: 14px;
            font-weight: 600;
            color: #2c3e50;
        }

        .detail-row .value.profit {
            color: #28a745;
        }

        .detail-row .value.profit-percent {
            color: #28a745;
        }

        .mandi-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 10px;
            border-top: 1px solid #f8f9fa;
            font-size: 12px;
            color: #6c757d;
        }

        .mandi-name {
            font-weight: 600;
        }

        .mandi-results {
            margin-top: 15px;
        }

        /* Search Results Styles */
        .mandi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .mandi-summary-square {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
            transition: transform 0.3s ease;
        }

        .mandi-summary-square:hover {
            transform: translateY(-2px);
        }

        .mandi-summary-square .square-header h6 {
            font-size: 14px;
            margin-bottom: 10px;
        }

        .mandi-summary-square .price-main {
            margin-bottom: 10px;
        }

        .mandi-summary-square .current-price {
            font-size: 18px;
        }

        .mandi-summary-square .mandi-name {
            font-size: 12px;
            margin-bottom: 5px;
        }

        .profit-info {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
        }

        .profit-info .profit {
            color: #28a745;
            font-weight: 600;
        }

        .profit-info .profit-percent {
            color: #28a745;
            font-weight: 600;
        }

        /* Crop Details Grid */
        .crop-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .crop-detail-square {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
            text-align: center;
        }

        .detail-label {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .detail-value {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
        }

        .detail-value.profit {
            color: #28a745;
        }

        .detail-value.profit-percent {
            color: #28a745;
        }

        .crop-result-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
        }

        .crop-result-card h6 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: 600;
            text-align: center;
        }

        /* Pest Analysis Styles */
        .pest-analysis-container {
            background: #fff;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }

        .analysis-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .analysis-header h4 {
            color: #2c5530;
            margin-bottom: 10px;
        }

        .image-analysis-result {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .analysis-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #28a745;
        }

        .analysis-card h5 {
            color: #2c5530;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .analysis-details {
            display: grid;
            gap: 10px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #dee2e6;
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        .detail-item .label {
            font-weight: 600;
            color: #495057;
        }

        .detail-item .value {
            font-weight: bold;
            color: #2c5530;
        }

        .detail-item .value.high {
            color: #dc3545;
        }

        .detail-item .value.severe {
            color: #dc3545;
            font-size: 1.1em;
        }

        .detail-item .value.moderate {
            color: #ffc107;
        }

        .detail-item .value.low {
            color: #28a745;
        }

        .treatment-recommendations {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #ffc107;
        }

        .treatment-recommendations h5 {
            color: #856404;
            margin-bottom: 15px;
        }

        .recommendations-grid {
            display: grid;
            gap: 15px;
        }

        .recommendation-card {
            background: #fff;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .recommendation-card h6 {
            color: #2c5530;
            margin-bottom: 10px;
        }

        .recommendation-card p {
            margin: 5px 0;
            color: #495057;
        }

        .pest-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .pest-category,
        .disease-category {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 20px;
        }

        .pest-category {
            border-left: 4px solid #17a2b8;
        }

        .disease-category {
            border-left: 4px solid #dc3545;
        }

        .pest-category h5,
        .disease-category h5 {
            margin-bottom: 15px;
            color: #2c5530;
        }

        .pest-item,
        .disease-item {
            background: #fff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .pest-item h6,
        .disease-item h6 {
            color: #2c5530;
            margin-bottom: 10px;
        }

        .pest-item p,
        .disease-item p {
            margin: 5px 0;
            color: #495057;
        }

        /* Mobile Responsive for Pest Analysis */
        @media (max-width: 768px) {
            .image-analysis-result {
                grid-template-columns: 1fr;
            }

            .pest-info-grid {
                grid-template-columns: 1fr;
            }

            .analysis-details {
                gap: 8px;
            }

            .detail-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
        }

        .mandi-result-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
        }

        .mandi-result-card h6 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: 600;
            font-size: 18px;
        }

        .mandi-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .mandi-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f8f9fa;
        }

        .mandi-item .label {
            font-weight: 600;
            color: #495057;
        }

        .mandi-item .value {
            color: #2c3e50;
            font-weight: 500;
        }

        .mandi-analysis {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .mandi-results-summary {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .mandi-results-summary h6 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .mandi-summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f8f9fa;
        }

        .mandi-summary-item:last-child {
            border-bottom: none;
        }

        .crop-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .crop-price {
            color: #28a745;
            font-weight: 600;
        }

        .crop-mandi {
            color: #6c757d;
            font-size: 14px;
        }

        .loading,
        .no-results,
        .error {
            text-align: center;
            padding: 20px;
            color: #6c757d;
            font-style: italic;
        }

        .error {
            color: #dc3545;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .search-boxes-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .mandi-search-box,
            .crop-search-box {
                flex-direction: column;
            }

            .mandi-prices-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .price-details {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .mandi-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .crop-details-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .mandi-info {
                flex-direction: column;
                gap: 5px;
                text-align: center;
            }

            .profit-info {
                flex-direction: column;
                gap: 5px;
                text-align: center;
            }
        }

        .services-container {
            padding: 60px 0;
            background: white;
        }

        .service-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer !important;
            border: 2px solid transparent;
            pointer-events: auto !important;
            user-select: none;
        }

        .service-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            border-color: #4a7c59;
        }

        .service-card:active {
            transform: scale(0.95);
            transition: transform 0.1s ease;
        }

        .service-card * {
            pointer-events: auto;
        }

        .service-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            color: #4a7c59;
        }

        .service-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2d5016;
            margin-bottom: 15px;
        }

        .service-description {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .service-button {
            background: linear-gradient(135deg, #4a7c59 0%, #2d5016 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .service-button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(74, 124, 89, 0.4);
        }

        .content-section {
            display: none;
            padding: 40px 0;
            background: #f8f9fa;
        }

        .content-section.active {
            display: block;
        }

        .data-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading i {
            font-size: 2rem;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .status-indicator {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 12px;
            height: 12px;
            background: #28a745;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }

            100% {
                opacity: 1;
            }
        }

        /* Real-Time Data Display Styles */
        .real-time-header {
            background: linear-gradient(135deg, #2d5016 0%, #4a7c59 100%);
            color: white;
            padding: 25px 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(74, 124, 89, 0.3);
        }

        .real-time-header h4 {
            margin-bottom: 15px;
            font-size: 1.6rem;
            font-weight: 600;
        }

        .data-source,
        .timestamp,
        .reliability,
        .analysis-info,
        .scheme-count {
            font-size: 0.95rem;
            opacity: 0.9;
            margin: 8px 0;
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            display: inline-block;
        }

        .scheme-count {
            background: rgba(255, 255, 255, 0.2);
            font-weight: 600;
        }

        /* Scheme Card Styles */
        .scheme-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #4a7c59;
            transition: all 0.3s ease;
        }

        .scheme-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .scheme-card h5 {
            color: #2c5530;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .scheme-card p {
            margin-bottom: 10px;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .scheme-card strong {
            color: #4a7c59;
            font-weight: 600;
        }

        .scheme-actions {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .scheme-actions .btn {
            flex: 1;
            min-width: 120px;
            padding: 10px 15px;
            font-size: 0.9rem;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .scheme-actions .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .schemes-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .scheme-details {
            margin-bottom: 15px;
        }

        .scheme-card {
            animation: fadeInUp 0.6s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .real-time-header {
                padding: 20px 15px;
                margin-bottom: 20px;
            }

            .real-time-header h4 {
                font-size: 1.4rem;
                margin-bottom: 12px;
            }

            .data-source,
            .timestamp,
            .reliability,
            .analysis-info,
            .scheme-count {
                font-size: 0.85rem;
                margin: 6px 0;
                padding: 4px 8px;
            }

            .scheme-card {
                padding: 15px;
                margin-bottom: 15px;
            }

            .scheme-card h5 {
                font-size: 1.2rem;
                margin-bottom: 12px;
            }

            .scheme-card p {
                font-size: 0.9rem;
                margin-bottom: 8px;
            }

            .scheme-actions {
                margin-top: 15px;
                gap: 8px;
            }

            .scheme-actions .btn {
                padding: 8px 12px;
                font-size: 0.85rem;
                min-width: 100px;
            }

            .schemes-container {
                gap: 15px;
            }

            .container {
                padding: 0 15px;
            }
        }

        @media (max-width: 480px) {
            .real-time-header h4 {
                font-size: 1.2rem;
            }

            .scheme-card h5 {
                font-size: 1.1rem;
            }

            .scheme-actions {
                flex-direction: column;
            }

            .scheme-actions .btn {
                width: 100%;
                margin-bottom: 5px;
            }

            .schemes-container {
                gap: 12px;
            }

            .location-search-container {
                max-width: 100%;
                margin: 20px auto;
            }

            .search-box {
                padding: 8px 15px;
            }

            .search-box input {
                font-size: 1rem;
                padding: 8px;
            }

            .current-location-display {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .crops-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .crop-card {
                min-height: 350px;
                padding: 15px;
            }

            .crop-header h5 {
                font-size: 1.1rem;
            }

            .service-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .service-card-item {
                min-height: 300px;
                padding: 15px;
            }

            .service-card-header h5 {
                font-size: 1.1rem;
            }
        }

        /* Crop Card Styles */
        .crop-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #4a7c59;
        }

        .crop-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .crop-header h5 {
            color: #2d5016;
            margin: 0;
        }

        .profitability-score {
            background: #4a7c59;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
        }

        .crop-details {
            margin-bottom: 15px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .detail-row .label {
            font-weight: bold;
            color: #666;
        }

        .detail-row .value {
            color: #2d5016;
            font-weight: 500;
        }

        .crop-scores {
            margin-top: 15px;
        }

        .score-item {
            margin-bottom: 10px;
        }

        .score-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
            display: block;
        }

        .score-bar {
            background: #f0f0f0;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .score-fill {
            background: linear-gradient(90deg, #4a7c59, #2d5016);
            height: 100%;
            transition: width 0.3s ease;
        }

        .score-value {
            font-size: 0.8rem;
            color: #4a7c59;
            font-weight: bold;
        }

        /* Weather Card Styles */
        .weather-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .current-weather {
            margin-bottom: 20px;
        }

        .weather-main {
            text-align: center;
            margin-bottom: 15px;
        }

        .weather-temp {
            font-size: 2.5rem;
            font-weight: bold;
            color: #2d5016;
            margin: 10px 0;
        }

        .weather-condition {
            font-size: 1.2rem;
            color: #666;
        }

        .weather-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .detail-item .icon {
            font-size: 1.2rem;
        }

        .detail-item .label {
            font-weight: bold;
            color: #666;
        }

        .detail-item .value {
            color: #2d5016;
            font-weight: 500;
        }

        .weather-forecast {
            margin-bottom: 20px;
        }

        .weather-forecast h6 {
            color: #2d5016;
            margin-bottom: 15px;
        }

        .forecast-day {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .farmer-advisory {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }

        .farmer-advisory h6 {
            color: #2d5016;
            margin-bottom: 10px;
        }

        .advisory-details {
            margin-top: 10px;
        }

        .advisory-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .advisory-item .icon {
            font-size: 1.1rem;
        }

        /* Price Card Styles */
        .price-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #4a7c59;
        }

        .price-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .price-header h5 {
            color: #2d5016;
            margin: 0;
        }

        .price-trend {
            font-size: 1.2rem;
        }

        .trend-up {
            color: #28a745;
        }

        .trend-down {
            color: #dc3545;
        }

        .trend-stable {
            color: #6c757d;
        }

        .price-details {
            margin-bottom: 15px;
        }

        .price-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .price-item .label {
            font-weight: bold;
            color: #666;
        }

        .price-item .value {
            color: #2d5016;
            font-weight: 500;
        }

        .current-price {
            color: #28a745 !important;
            font-weight: bold !important;
        }

        .msp-price {
            color: #007bff !important;
            font-weight: bold !important;
        }

        .price-analysis {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .analysis-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .analysis-label {
            font-weight: bold;
            color: #666;
        }

        .analysis-value {
            color: #28a745;
            font-weight: bold;
        }

        .chat-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            background: white;
        }

        .message {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 10px;
        }

        .user-message {
            background: #e3f2fd;
            margin-left: 20%;
        }

        .bot-message {
            background: #f1f8e9;
            margin-right: 20%;
        }

        .input-group {
            margin-top: 20px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            display: none;
        }

        .notification.success {
            background: #28a745;
        }

        .notification.error {
            background: #dc3545;
        }

        .notification.info {
            background: #17a2b8;
        }

        /* Weather UI Improvements */
        .weather-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .weather-temp {
            font-size: 3rem;
            font-weight: bold;
            color: #2d5016;
            margin: 10px 0;
        }

        .weather-condition {
            font-size: 1.2rem;
            color: #4a7c59;
            margin-bottom: 10px;
        }

        .weather-feels-like {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 15px;
        }

        .detail-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        .detail-item .icon {
            font-size: 1.2rem;
            margin-right: 10px;
            width: 25px;
        }

        .detail-item .label {
            font-weight: 500;
            margin-right: 10px;
            min-width: 100px;
        }

        .detail-item .value {
            font-weight: bold;
            color: #2d5016;
        }

        .forecast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .forecast-item {
            text-align: center;
            padding: 15px;
            background: rgba(45, 80, 22, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(45, 80, 22, 0.2);
        }

        .forecast-day {
            font-weight: bold;
            color: #2d5016;
            margin-bottom: 8px;
        }

        .forecast-temp {
            font-size: 1.1rem;
            font-weight: bold;
            color: #4a7c59;
            margin-bottom: 5px;
        }

        .forecast-condition {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }

        .forecast-humidity,
        .forecast-wind {
            font-size: 0.8rem;
            color: #888;
        }

        .agricultural-advice {
            background: rgba(74, 124, 89, 0.1);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #4a7c59;
        }

        .agricultural-advice p {
            margin: 0;
            color: #2d5016;
            line-height: 1.6;
        }

        .real-time-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(45, 80, 22, 0.2);
        }

        .real-time-header h4 {
            color: #2d5016;
            margin-bottom: 10px;
        }

        .data-source {
            font-size: 0.9rem;
            color: #4a7c59;
            margin: 5px 0;
        }

        .timestamp {
            font-size: 0.8rem;
            color: #666;
            margin: 5px 0;
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
            <a class="navbar-brand" href="#">
                üåæ ‡§ï‡•É‡§∑‡§ø‡§Æ‡§ø‡§§‡•ç‡§∞ AI
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showService('home')">‡§π‡•ã‡§Æ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showService('government-schemes')">‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showService('ai-assistant')">AI ‡§∏‡§π‡§æ‡§Ø‡§ï</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="hero-section">
        <div class="container">
            <h1 class="hero-title">üåæ ‡§ï‡•É‡§∑‡§ø‡§Æ‡§ø‡§§‡•ç‡§∞ AI</h1>
            <p class="hero-subtitle">‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç ‡§ï‡§æ ‡§∏‡§¨‡§∏‡•á ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§¶‡•ã‡§∏‡•ç‡§§ - AI ‡§∏‡•á ‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§ñ‡•á‡§§‡•Ä ‡§ï‡§∞‡•á‡§Ç</p>

            <!-- Location Search Bar -->
            <div class="location-search-container">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="locationSearchInput" placeholder="‡§∂‡§π‡§∞, ‡§ú‡§ø‡§≤‡§æ ‡§Ø‡§æ ‡§ó‡§æ‡§Å‡§µ ‡§ñ‡•ã‡§ú‡•á‡§Ç..."
                        onkeyup="searchLocations(event)" onfocus="showLocationSuggestions()">
                    <button class="btn btn-primary" onclick="searchCurrentLocation()">
                        <i class="fas fa-map-marker-alt"></i>
                    </button>
                </div>
                <div id="locationSuggestions" class="location-suggestions"></div>
            </div>

            <div class="current-location-display">
                <span class="location-label">üìç ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§∏‡•ç‡§•‡§æ‡§®:</span>
                <span id="currentLocationDisplay" class="location-name">Delhi</span>
                <button class="btn btn-sm btn-outline-light" onclick="detectLocation()">
                    <i class="fas fa-crosshairs"></i> ‡§∏‡•ç‡§•‡§æ‡§® ‡§™‡§§‡§æ ‡§ï‡§∞‡•á‡§Ç
                </button>
            </div>
        </div>
    </div>

    <!-- Services Section -->
    <div class="services-container">
        <div class="container">
            <h2 class="text-center mb-5" style="color: #2d5016;">‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§∏‡•á‡§µ‡§æ‡§è‡§Ç</h2>

            <div class="row">
                <!-- Government Schemes -->
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="service-card" onclick="showService('government-schemes')">
                        <div class="status-indicator"></div>
                        <div class="service-icon">üèõÔ∏è</div>
                        <h3 class="service-title">‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç</h3>
                        <p class="service-description">‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞ ‡§î‡§∞ ‡§∞‡§æ‡§ú‡•ç‡§Ø ‡§∏‡§∞‡§ï‡§æ‡§∞ ‡§ï‡•Ä ‡§ï‡•É‡§∑‡§ø ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç‡•§ ‡§∏‡§¨‡•ç‡§∏‡§ø‡§°‡•Ä, ‡§ã‡§£ ‡§î‡§∞ ‡§Ö‡§®‡•ç‡§Ø ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ
                            ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä‡•§</p>
                        <button class="service-button">‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç ‡§¶‡•á‡§ñ‡•á‡§Ç</button>
                    </div>
                </div>

                <!-- Crop Recommendations -->
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="service-card" onclick="showService('crop-recommendations')">
                        <div class="status-indicator"></div>
                        <div class="service-icon">üåæ</div>
                        <h3 class="service-title">‡§´‡§∏‡§≤ ‡§∏‡•Å‡§ù‡§æ‡§µ</h3>
                        <p class="service-description">AI ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§Ü‡§™‡§ï‡•á ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§∞‡•ç‡§µ‡•ã‡§§‡•ç‡§§‡§Æ ‡§´‡§∏‡§≤‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡§ø‡§´‡§æ‡§∞‡§ø‡§∂‡•§ ‡§Æ‡•å‡§∏‡§Æ,
                            ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä, ‡§ï‡•Ä‡§Æ‡§§‡•ã‡§Ç ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞‡•§</p>
                        <button class="service-button">‡§´‡§∏‡§≤ ‡§∏‡•Å‡§ù‡§æ‡§µ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç</button>
                    </div>
                </div>

                <!-- Weather -->
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="service-card" onclick="showService('weather')">
                        <div class="status-indicator"></div>
                        <div class="service-icon">üå§Ô∏è</div>
                        <h3 class="service-title">‡§Æ‡•å‡§∏‡§Æ ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§®‡•Å‡§Æ‡§æ‡§®</h3>
                        <p class="service-description">‡§∏‡§ü‡•Ä‡§ï ‡§Æ‡•å‡§∏‡§Æ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§î‡§∞ ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§®‡•Å‡§Æ‡§æ‡§®‡•§ ‡§¨‡§æ‡§∞‡§ø‡§∂, ‡§§‡§æ‡§™‡§Æ‡§æ‡§®, ‡§π‡§µ‡§æ ‡§ï‡•Ä ‡§ó‡§§‡§ø ‡§∏‡§¨
                            ‡§ï‡•Å‡§õ ‡§™‡§§‡§æ ‡§ï‡§∞‡•á‡§Ç‡•§</p>
                        <button class="service-button">‡§Æ‡•å‡§∏‡§Æ ‡§¶‡•á‡§ñ‡•á‡§Ç</button>
                    </div>
                </div>

                <!-- Market Prices -->
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="service-card" onclick="showService('market-prices')">
                        <div class="status-indicator"></div>
                        <div class="service-icon">üí∞</div>
                        <h3 class="service-title">‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§ï‡•Ä‡§Æ‡§§‡•á‡§Ç</h3>
                        <p class="service-description">‡§∞‡§ø‡§Ø‡§≤-‡§ü‡§æ‡§á‡§Æ ‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§ï‡•Ä‡§Æ‡§§‡•á‡§Ç ‡§î‡§∞ ‡§∞‡•Å‡§ù‡§æ‡§®‡•§ ‡§Ö‡§™‡§®‡•Ä ‡§´‡§∏‡§≤ ‡§ï‡•Ä ‡§∏‡§π‡•Ä ‡§ï‡•Ä‡§Æ‡§§ ‡§ú‡§æ‡§®‡•á‡§Ç ‡§î‡§∞
                            ‡§¨‡•á‡§ö‡§®‡•á ‡§ï‡§æ ‡§∏‡§π‡•Ä ‡§∏‡§Æ‡§Ø ‡§™‡§§‡§æ ‡§ï‡§∞‡•á‡§Ç‡•§</p>
                        <button class="service-button">‡§ï‡•Ä‡§Æ‡§§‡•á‡§Ç ‡§¶‡•á‡§ñ‡•á‡§Ç</button>
                    </div>
                </div>

                <!-- Pest Control -->
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="service-card" onclick="showService('pest-control')">
                        <div class="status-indicator"></div>
                        <div class="service-icon">üêõ</div>
                        <h3 class="service-title">‡§ï‡•Ä‡§ü ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£</h3>
                        <p class="service-description">AI ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§ï‡•Ä‡§ü ‡§î‡§∞ ‡§∞‡•ã‡§ó ‡§ï‡•Ä ‡§™‡§π‡§ö‡§æ‡§®‡•§ ‡§´‡§∏‡§≤ ‡§ï‡•Ä ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§°‡§æ‡§≤‡•á‡§Ç ‡§î‡§∞ ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§ú‡§æ‡§®‡•á‡§Ç
                            ‡§ï‡§ø ‡§ï‡•ç‡§Ø‡§æ ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§π‡•à ‡§î‡§∞ ‡§ï‡•à‡§∏‡•á ‡§†‡•Ä‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§</p>
                        <button class="service-button">‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§∞‡•á‡§Ç</button>
                    </div>
                </div>

                <!-- AI Assistant -->
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="service-card" onclick="showService('ai-assistant')">
                        <div class="status-indicator"></div>
                        <div class="service-icon">ü§ñ</div>
                        <h3 class="service-title">AI ‡§∏‡§π‡§æ‡§Ø‡§ï</h3>
                        <p class="service-description">‡§ï‡•É‡§∑‡§ø ‡§∏‡•á ‡§ú‡•Å‡§°‡§º‡•á ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§∏‡§µ‡§æ‡§≤ ‡§ï‡§æ ‡§ú‡§µ‡§æ‡§¨ ‡§™‡§æ‡§è‡§Ç‡•§ 24/7 ‡§â‡§™‡§≤‡§¨‡•ç‡§ß AI ‡§∏‡§π‡§æ‡§Ø‡§ï ‡§∏‡•á
                            ‡§¨‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§∏‡§≤‡§æ‡§π ‡§≤‡•á‡§Ç‡•§</p>
                        <button class="service-button">‡§¨‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Content Sections -->
    <div class="content-section" id="government-schemes-content">
        <div class="container">
            <h2 class="text-center mb-4">üèõÔ∏è ‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç</h2>
            <div id="schemesData" class="loading">
                <i class="fas fa-spinner"></i>
                <p>‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à‡§Ç...</p>
            </div>
        </div>
    </div>

    <div class="content-section" id="crop-recommendations-content">
        <div class="container">
            <h2 class="text-center mb-4">üåæ ‡§´‡§∏‡§≤ ‡§∏‡•Å‡§ù‡§æ‡§µ</h2>

            <!-- Crop Search Bar -->
            <div class="crop-search-container mb-4">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="cropSearchInput" placeholder="‡§´‡§∏‡§≤ ‡§ñ‡•ã‡§ú‡•á‡§Ç (‡§ú‡•à‡§∏‡•á: ‡§ó‡•á‡§π‡•Ç‡§Ç, ‡§ß‡§æ‡§®, ‡§Æ‡§ï‡•ç‡§ï‡§æ)..."
                        onkeyup="searchCrop(event)" onfocus="showCropSuggestions()">
                    <button class="btn btn-primary" onclick="searchSpecificCrop()">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                <div id="cropSuggestions" class="crop-suggestions"></div>
            </div>

            <div id="cropsData" class="loading">
                <i class="fas fa-spinner"></i>
                <p>‡§´‡§∏‡§≤ ‡§∏‡•Å‡§ù‡§æ‡§µ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...</p>
            </div>
        </div>
    </div>

    <div class="content-section" id="weather-content">
        <div class="container">
            <h2 class="text-center mb-4">üå§Ô∏è ‡§Æ‡•å‡§∏‡§Æ ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§®‡•Å‡§Æ‡§æ‡§®</h2>
            <div id="weatherData" class="loading">
                <i class="fas fa-spinner"></i>
                <p>‡§Æ‡•å‡§∏‡§Æ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à...</p>
            </div>
        </div>
    </div>

    <div class="content-section" id="market-prices-content">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="text-center mb-0">üí∞ ‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§ï‡•Ä‡§Æ‡§§‡•á‡§Ç</h2>
                <button onclick="forceReloadMarketPrices()" class="btn btn-outline-primary btn-sm">
                    <i class="fas fa-sync-alt"></i> ‡§∞‡§ø‡§´‡•ç‡§∞‡•á‡§∂ ‡§ï‡§∞‡•á‡§Ç
                </button>
            </div>
            <div id="pricesData" class="loading">
                <i class="fas fa-spinner"></i>
                <p>‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§ï‡•Ä‡§Æ‡§§‡•á‡§Ç ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à‡§Ç...</p>
            </div>
        </div>
    </div>

    <div class="content-section" id="pest-control-content">
        <div class="container">
            <h2 class="text-center mb-4">ü©∫ KrishiRaksha 2.0: Advanced Diagnostics</h2>

            <!-- Step 1: Crop Selection -->
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-seedling"></i> Step 1: Select Your Crop (‡§´‡§∏‡§≤ ‡§ö‡•Å‡§®‡•á‡§Ç)</h5>
                </div>
                <div class="card-body">
                    <select class="form-select form-select-lg" id="krCropSelect">
                        <option value="">-- Choose Crop / ‡§´‡§∏‡§≤ ‡§ö‡•Å‡§®‡•á‡§Ç --</option>
                        <option value="tomato">Tomato (‡§ü‡§Æ‡§æ‡§ü‡§∞)</option>
                        <option value="rice">Rice (‡§ß‡§æ‡§®)</option>
                        <option value="potato">Potato (‡§Ü‡§≤‡•Ç)</option>
                        <option value="banana">Banana (‡§ï‡•á‡§≤‡§æ)</option>
                        <option value="chilli">Chilli (‡§Æ‡§ø‡§∞‡•ç‡§ö)</option>
                        <option value="other">Other (‡§Ö‡§®‡•ç‡§Ø)</option>
                    </select>
                </div>
            </div>

            <!-- Step 2: Multi-Image Upload -->
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-camera"></i> Step 2: Multi-Angle Analysis (‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞‡•á‡§Ç ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç)
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <div class="upload-box text-center p-3 border rounded bg-light h-100">
                                <i class="fas fa-tree fa-2x text-success mb-2"></i>
                                <h6>Whole Plant (‡§™‡•Ç‡§∞‡•Ä ‡§´‡§∏‡§≤)</h6>
                                <input type="file" id="imgWhole" class="form-control mb-2" accept="image/*">
                                <small class="text-muted d-block">Take a photo from 5-10ft away</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="upload-box text-center p-3 border rounded bg-light h-100">
                                <i class="fas fa-search-plus fa-2x text-danger mb-2"></i>
                                <h6>Affected Part (‡§®‡§ú‡§¶‡•Ä‡§ï ‡§∏‡•á)</h6>
                                <input type="file" id="imgCloseUp" class="form-control mb-2" accept="image/*">
                                <small class="text-muted d-block">Zoom in on the disease/pest</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="upload-box text-center p-3 border rounded bg-light h-100">
                                <i class="fas fa-leaf fa-2x text-warning mb-2"></i>
                                <h6>Leaf Texture (‡§™‡§§‡•ç‡§§‡•Ä ‡§ï‡§æ ‡§™‡•à‡§ü‡§∞‡•ç‡§®)</h6>
                                <input type="file" id="imgLeaf" class="form-control mb-2" accept="image/*">
                                <small class="text-muted d-block">Clear photo of leaf veins/spots</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action -->
            <div class="text-center mb-5">
                <button class="btn btn-lg btn-danger px-5 py-3 rounded-pill shadow"
                    onclick="runKrishiRakshaDiagnosis()">
                    <i class="fas fa-microscope fa-lg"></i> Run Diagnosis (‡§ú‡§æ‡§Ç‡§ö ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç)
                </button>
            </div>

            <!-- Results Container -->
            <div id="krishiRakshaResults" style="display:none;" class="animated-result">
                <div class="text-center p-5">
                    <i class="fas fa-spinner fa-spin fa-3x text-success"></i>
                    <h4 class="mt-3">Analyzing Crop Health...</h4>
                    <p>Checking 150+ Diseases ‚Ä¢ Verifying with Weather Data...</p>
                </div>
            </div>
        </div>
    </div>

    <div class="content-section" id="ai-assistant-content">
        <div class="container">
            <h2 class="text-center mb-4">ü§ñ AI ‡§∏‡§π‡§æ‡§Ø‡§ï</h2>
            <div class="chat-container" id="chatMessages">
                <div class="message bot-message">
                    <strong>‡§ï‡•É‡§∑‡§ø‡§Æ‡§ø‡§§‡•ç‡§∞ AI:</strong> ‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§ï‡•É‡§∑‡§ø ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡•Ä ‡§∏‡§≠‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ‡§ì‡§Ç ‡§Æ‡•á‡§Ç ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Ç‡•§ ‡§Ü‡§™
                    ‡§ï‡•ç‡§Ø‡§æ ‡§ú‡§æ‡§®‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?
                </div>
            </div>
            <div class="input-group">
                <input type="text" class="form-control" id="messageInput" placeholder="‡§Ö‡§™‡§®‡§æ ‡§∏‡§µ‡§æ‡§≤ ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç...">
                <button class="btn btn-success" onclick="sendMessage()">‡§≠‡•á‡§ú‡•á‡§Ç</button>
            </div>
            <div id="loading" style="display: none; text-align: center; margin-top: 10px;">
                <i class="fas fa-spinner"></i> ‡§∏‡•ã‡§ö ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Ç...
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let currentLocation = 'Delhi';
        let currentLatitude = 28.7041;
        let currentLongitude = 77.1025;
        let sessionId = 'session_' + Date.now();
        let locationSearchTimeout;

        // Function to decode HTML entities
        function decodeHtmlEntities(text) {
            if (!text) return text;
            const textarea = document.createElement('textarea');
            textarea.innerHTML = text;
            return textarea.value;
        }

        // Show service content
        /* COMMENTED OUT - Using enhanced_services.js instead
                function showService(serviceName) {
                    console.log('üéØ Showing service:', serviceName);
        
                    try {
                        // Hide all content sections
                        document.querySelectorAll('.content-section').forEach(section => {
                            section.classList.remove('active');
                        });
        
                        // Show selected content
                        const content = document.getElementById(serviceName + '-content');
                        if (content) {
                            content.classList.add('active');
                            content.scrollIntoView({ behavior: 'smooth' });
        
                            // Load data for the service
                            loadServiceData(serviceName);
                        } else {
                            console.error('Content section not found:', serviceName + '-content');
                            alert('Service content not found. Please try again.');
                        }
                    } catch (error) {
                        console.error('Error showing service:', error);
                        alert('Error loading service. Please try again.');
                    }
                }
        */

        // Load service data
        /* COMMENTED OUT - Using enhanced_services.js instead
                function loadServiceData(serviceName) {
                    switch (serviceName) {
                        case 'government-schemes':
                            loadGovernmentSchemes();
                            break;
                        case 'crop-recommendations':
                            loadCropRecommendations();
                            break;
                        case 'weather':
                            loadWeatherData();
                            break;
                        case 'market-prices':
                            loadMarketPrices();
                            break;
                        case 'pest-control':
                            loadPestControl();
                            break;
                        case 'ai-assistant':
                            // AI assistant is already loaded
                            break;
                    }
                }
        */

        // Load Government Schemes - Ultra-Dynamic Real-Time Data
        /* COMMENTED OUT - Using enhanced_services.js instead
        /* COMMENTED OUT - Using enhanced_services.js instead
                        async function loadGovernmentSchemes() {
                            const container = document.getElementById('schemesData');
                            
                            try {
                                // Add cache-busting timestamp
                                const timestamp = new Date().getTime();
                                const response = await fetch(`/api/government-schemes/?location=${currentLocation}&t=${timestamp}`);
                                const data = await response.json();
                                
                                console.log('Government Schemes Data for', currentLocation, ':', data);
                                
                                // Use combined schemes list or fallback to central_schemes
                                const schemes = data.schemes || data.central_schemes || [];
                                
                                if (schemes.length > 0) {
                                    container.innerHTML = `
                                        <div class="real-time-header">
                                            <h4>üèõÔ∏è ‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç</h4>
                                            <p class="data-source">üìä ‡§∏‡•ç‡§∞‡•ã‡§§: ${data.data_source}</p>
                                            <p class="timestamp">üïí ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§Ö‡§™‡§°‡•á‡§ü: ${new Date(data.timestamp).toLocaleString('hi-IN')}</p>
                                            <p class="scheme-count">üìä ‡§ï‡•Å‡§≤ ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç: ${data.total_schemes || schemes.length}</p>
                                        </div>
                                        <div class="service-grid">
                                            ${schemes.map((scheme, index) => `
                                                <div class="service-card-item" style="animation-delay: ${index * 0.1}s">
                                                    <div class="service-card-header">
                                                        <h5>${scheme.name || scheme.name_en || 'Government Scheme'}</h5>
                                                        <div class="service-card-badge">‡§Ø‡•ã‡§ú‡§®‡§æ</div>
                                                    </div>
                                                    <div class="service-card-content">
                                                        <div class="service-card-info">
                                                            <div class="service-info-item">
                                                                <span class="service-info-label">üí∞ ‡§∞‡§æ‡§∂‡§ø:</span>
                                                                <span class="service-info-value">${scheme.amount || '‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç'}</span>
                                                            </div>
                                                            <div class="service-info-item">
                                                                <span class="service-info-label">üìù ‡§µ‡§ø‡§µ‡§∞‡§£:</span>
                                                                <span class="service-info-value">${(scheme.description || '‡§µ‡§ø‡§µ‡§∞‡§£ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç').substring(0, 50)}...</span>
                                                            </div>
                                                            <div class="service-info-item">
                                                                <span class="service-info-label">‚úÖ ‡§™‡§æ‡§§‡•ç‡§∞‡§§‡§æ:</span>
                                                                <span class="service-info-value">${scheme.eligibility || '‡§∏‡§≠‡•Ä ‡§ï‡§ø‡§∏‡§æ‡§®'}</span>
                                                            </div>
                                                            <div class="service-info-item">
                                                                <span class="service-info-label">üìû ‡§π‡•á‡§≤‡•ç‡§™‡§≤‡§æ‡§á‡§®:</span>
                                                                <span class="service-info-value">${scheme.helpline || '1800-180-1551'}</span>
                                                            </div>
                                                        </div>
                                                        <div class="service-card-actions">
                                                            <button class="service-action-btn" onclick="openSchemeApplication('${scheme.apply_link || scheme.official_website || '#'}')">
                                                                <i class="fas fa-file-alt"></i> ‡§Ü‡§µ‡•á‡§¶‡§® ‡§ï‡§∞‡•á‡§Ç
                                                            </button>
                                                            <button class="service-action-btn secondary" onclick="openGovernmentScheme('${scheme.official_website || '#'}')">
                                                                <i class="fas fa-globe"></i> ‡§Ü‡§ß‡§ø‡§ï‡§æ‡§∞‡§ø‡§ï ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    `;
                                } else {
                                    container.innerHTML = `
                                        <div class="real-time-header">
                                            <h4>üèõÔ∏è ‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç - ${currentLocation}</h4>
                                            <p class="data-source">üìä ‡§∏‡•ç‡§∞‡•ã‡§§: Ultra-Dynamic Government APIs</p>
                                        </div>
                                        <div class="scheme-card">
                                            <h5>‡§™‡•ç‡§∞‡§ß‡§æ‡§®‡§Æ‡§Ç‡§§‡•ç‡§∞‡•Ä ‡§ï‡§ø‡§∏‡§æ‡§® ‡§∏‡§Æ‡•ç‡§Æ‡§æ‡§® ‡§®‡§ø‡§ß‡§ø</h5>
                                            <p><strong>üí∞ ‡§∞‡§æ‡§∂‡§ø:</strong> ‚Çπ6,000 ‡§™‡•ç‡§∞‡§§‡§ø ‡§µ‡§∞‡•ç‡§∑</p>
                                            <p><strong>üìù ‡§µ‡§ø‡§µ‡§∞‡§£:</strong> ‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç ‡§ï‡•ã ‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡§ï‡•ç‡§∑ ‡§Ü‡§Ø ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ</p>
                                            <p><strong>‚úÖ ‡§™‡§æ‡§§‡•ç‡§∞‡§§‡§æ:</strong> ‡§∏‡§≠‡•Ä ‡§ï‡§ø‡§∏‡§æ‡§® ‡§™‡§∞‡§ø‡§µ‡§æ‡§∞</p>
                                            <p><strong>üìû ‡§π‡•á‡§≤‡•ç‡§™‡§≤‡§æ‡§á‡§®:</strong> 1800-180-1551</p>
                                            <div class="scheme-actions">
                                                <button class="btn btn-primary" onclick="openSchemeApplication('https://pmkisan.gov.in/')">‡§Ü‡§µ‡•á‡§¶‡§® ‡§ï‡§∞‡•á‡§Ç</button>
                                                <button class="btn btn-info" onclick="openGovernmentScheme('https://pmkisan.gov.in/')">‡§Ü‡§ß‡§ø‡§ï‡§æ‡§∞‡§ø‡§ï ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü</button>
                                            </div>
                                        </div>
                                    `;
                                }
                            } catch (error) {
                                console.error('Error loading schemes:', error);
                                container.innerHTML = `
                                    <div class="real-time-header">
                                        <h4>üèõÔ∏è ‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç - ${currentLocation}</h4>
                                        <p class="data-source">üìä ‡§∏‡•ç‡§∞‡•ã‡§§: Ultra-Dynamic Government APIs</p>
                                    </div>
                                    <div class="scheme-card">
                                        <h5>‡§™‡•ç‡§∞‡§ß‡§æ‡§®‡§Æ‡§Ç‡§§‡•ç‡§∞‡•Ä ‡§ï‡§ø‡§∏‡§æ‡§® ‡§∏‡§Æ‡•ç‡§Æ‡§æ‡§® ‡§®‡§ø‡§ß‡§ø</h5>
                                        <p><strong>üí∞ ‡§∞‡§æ‡§∂‡§ø:</strong> ‚Çπ6,000 ‡§™‡•ç‡§∞‡§§‡§ø ‡§µ‡§∞‡•ç‡§∑</p>
                                        <p><strong>üìù ‡§µ‡§ø‡§µ‡§∞‡§£:</strong> ‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç ‡§ï‡•ã ‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡§ï‡•ç‡§∑ ‡§Ü‡§Ø ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ</p>
                                        <p><strong>‚úÖ ‡§™‡§æ‡§§‡•ç‡§∞‡§§‡§æ:</strong> ‡§∏‡§≠‡•Ä ‡§ï‡§ø‡§∏‡§æ‡§® ‡§™‡§∞‡§ø‡§µ‡§æ‡§∞</p>
                                        <p><strong>üìû ‡§π‡•á‡§≤‡•ç‡§™‡§≤‡§æ‡§á‡§®:</strong> 1800-180-1551</p>
                                        <div class="scheme-actions">
                                            <button class="btn btn-primary" onclick="openSchemeApplication('https://pmkisan.gov.in/')">‡§Ü‡§µ‡•á‡§¶‡§® ‡§ï‡§∞‡•á‡§Ç</button>
                                            <button class="btn btn-info" onclick="openGovernmentScheme('https://pmkisan.gov.in/')">‡§Ü‡§ß‡§ø‡§ï‡§æ‡§∞‡§ø‡§ï ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü</button>
                                        </div>
                                    </div>
                                `;
                            }
                        }
        */


            // Load Crop Recommendations - Ultra-Dynamic Real-Time Data (100+ Crops)
            /* COMMENTED OUT - Using enhanced_services.js instead
            /* COMMENTED OUT - Using enhanced_services.js instead
                            async function loadCropRecommendations_LEGACY() {
                                const container = document.getElementById('cropsData');
                                
                                try {
                                    // Add cache-busting timestamp
                                    const timestamp = new Date().getTime();
                                    const response = await fetch(`/api/advisories/?location=${currentLocation}&t=${timestamp}`);
                                    const data = await response.json();
                                    
                                    console.log('Crop Recommendations Data for', currentLocation, ':', data);
                                    
                                    if (data.top_4_recommendations && data.top_4_recommendations.length > 0) {
                                        const recommendations = data.top_4_recommendations;
                                        container.innerHTML = `
                                            <div class="real-time-header">
                                                <h4>üåæ ‡§´‡§∏‡§≤ ‡§∏‡•Å‡§ù‡§æ‡§µ - ${data.location}</h4>
                                                <p class="data-source">üìä ‡§∏‡•ç‡§∞‡•ã‡§§: ${data.data_source || 'Ultra-Dynamic Government APIs'}</p>
                                                <p class="timestamp">üïí ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§Ö‡§™‡§°‡•á‡§ü: ${new Date(data.timestamp).toLocaleString('hi-IN')}</p>
                                                <p class="analysis-info">üìà ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£: ${data.total_crops_analyzed || recommendations.length} ‡§´‡§∏‡§≤‡•ã‡§Ç ‡§ï‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£</p>
                                            </div>
                                            <div class="crops-grid">
                                                ${recommendations.map((crop, index) => `
                                                    <div class="crop-card">
                                                        <div class="crop-header">
                                                            <h5>${decodeHtmlEntities(crop.name_hindi || crop.crop_name_hindi || crop.crop_name)}</h5>
                                                            <div class="crop-rank">#${index + 1}</div>
                                                            <div class="profitability-score">${crop.profitability_score || 85}/100</div>
                                                        </div>
                                                        <div class="crop-content">
                                                            <div class="crop-info">
                                                                <div class="info-item">
                                                                    <span class="info-label">üí∞ MSP:</span>
                                                                    <span class="info-value">${crop.current_market_price || crop.msp || '‚Çπ2,000/quintal'}</span>
                                                                </div>
                                                                <div class="info-item">
                                                                    <span class="info-label">üìä ‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§®:</span>
                                                                    <span class="info-value">${crop.yield_prediction || crop.yield || '50 quintals/hectare'}</span>
                                                                </div>
                                                                <div class="info-item">
                                                                    <span class="info-label">üíµ ‡§≤‡§æ‡§≠:</span>
                                                                    <span class="info-value">${crop.profit || crop.profit_per_hectare || '‚Çπ15,000/hectare'} (${crop.profit_percentage || '25%'})</span>
                                                                </div>
                                                                <div class="info-item">
                                                                    <span class="info-label">üí∏ ‡§≤‡§æ‡§ó‡§§:</span>
                                                                    <span class="info-value">${crop.input_cost || crop.input_cost_per_hectare || '‚Çπ35,000/hectare'}</span>
                                                                </div>
                                                                <div class="info-item">
                                                                    <span class="info-label">üìà ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø ‡§ï‡•Ä ‡§ï‡•Ä‡§Æ‡§§ (3 ‡§Æ‡§π‡•Ä‡§®‡•á):</span>
                                                                    <span class="info-value">${crop.future_price_prediction?.next_3_months || 'N/A'}</span>
                                                                </div>
                                                                <div class="info-item">
                                                                    <span class="info-label">üìà ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø ‡§ï‡•Ä ‡§ï‡•Ä‡§Æ‡§§ (6 ‡§Æ‡§π‡•Ä‡§®‡•á):</span>
                                                                    <span class="info-value">${crop.future_price_prediction?.next_6_months || 'N/A'}</span>
                                                                </div>
                                                                <div class="info-item">
                                                                    <span class="info-label">üìà ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø ‡§ï‡•Ä ‡§ï‡•Ä‡§Æ‡§§ (1 ‡§µ‡§∞‡•ç‡§∑):</span>
                                                                    <span class="info-value">${crop.future_price_prediction?.next_year || 'N/A'}</span>
                                                                </div>
                                                            </div>
                                                            <div class="crop-metrics">
                                                                <div class="metric">
                                                                    <span class="metric-label">‡§≤‡§æ‡§≠‡§¶‡§æ‡§Ø‡§ï‡§§‡§æ:</span>
                                                                    <span class="metric-value">${crop.profitability_score || 85}/100</span>
                                                                </div>
                                                                <div class="metric">
                                                                    <span class="metric-label">‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§Æ‡§æ‡§Ç‡§ó:</span>
                                                                    <span class="metric-value">${crop.market_demand || 'Very High'}</span>
                                                                </div>
                                                                <div class="metric">
                                                                    <span class="metric-label">‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§∏‡•ç‡§§‡§∞:</span>
                                                                    <span class="metric-value">${crop.risk_level || 'Low'}</span>
                                                                </div>
                                                                <div class="metric">
                                                                    <span class="metric-label">‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä:</span>
                                                                    <span class="metric-value">${crop.soil_type || 'loamy'}</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                `).join('')}
                                            </div>
                                        `;
                                    } else {
                                        container.innerHTML = `
                                            <div class="real-time-header">
                                                <h4>üåæ ‡§´‡§∏‡§≤ ‡§∏‡•Å‡§ù‡§æ‡§µ - ${currentLocation}</h4>
                                                <p class="data-source">üìä ‡§∏‡•ç‡§∞‡•ã‡§§: Ultra-Dynamic Government APIs</p>
                                            </div>
                                            <div class="crop-card">
                                                <div class="crop-header">
                                                    <h5>1. ‡§ó‡•á‡§π‡•Ç‡§Ç</h5>
                                                    <span class="profitability-score">85/100</span>
                                                </div>
                                                <div class="crop-details">
                                                    <div class="detail-row">
                                                        <span class="label">üí∞ MSP:</span>
                                                        <span class="value">‚Çπ2,000/quintal</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="label">üìä ‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§®:</span>
                                                        <span class="value">50 quintals/hectare</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="label">üíµ ‡§≤‡§æ‡§≠:</span>
                                                        <span class="value">‚Çπ15,000/hectare (25%)</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="label">üí∏ ‡§≤‡§æ‡§ó‡§§:</span>
                                                        <span class="value">‚Çπ35,000/hectare</span>
                                                    </div>
                                                </div>
                                            </div>
                                        `;
                                    }
                                } catch (error) {
                                    console.error('Error loading crops:', error);
                                    container.innerHTML = `
                                        <div class="real-time-header">
                                            <h4>üåæ ‡§´‡§∏‡§≤ ‡§∏‡•Å‡§ù‡§æ‡§µ - ${currentLocation}</h4>
                                            <p class="data-source">üìä ‡§∏‡•ç‡§∞‡•ã‡§§: Ultra-Dynamic Government APIs</p>
                                        </div>
                                        <div class="crop-card">
                                            <div class="crop-header">
                                                <h5>1. ‡§ó‡•á‡§π‡•Ç‡§Ç</h5>
                                                <span class="profitability-score">85/100</span>
                                            </div>
                                            <div class="crop-details">
                                                <div class="detail-row">
                                                    <span class="label">üí∞ MSP:</span>
                                                    <span class="value">‚Çπ2,000/quintal</span>
                                                </div>
                                                <div class="detail-row">
                                                    <span class="label">üìä ‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§®:</span>
                                                    <span class="value">50 quintals/hectare</span>
                                                </div>
                                                <div class="detail-row">
                                                    <span class="label">üíµ ‡§≤‡§æ‡§≠:</span>
                                                    <span class="value">‚Çπ15,000/hectare (25%)</span>
                                                </div>
                                                <div class="detail-row">
                                                    <span class="label">üí∏ ‡§≤‡§æ‡§ó‡§§:</span>
                                                    <span class="value">‚Çπ35,000/hectare</span>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }
                            }
            */
            */

            // Load Weather Data - Ultra-Dynamic Real-Time IMD Data
            /* COMMENTED OUT - Using enhanced_services.js instead
            /* COMMENTED OUT - Using enhanced_services.js instead
                            async function loadWeatherData() {
                                const container = document.getElementById('weatherData');
                                
                                try {
                                    // Add cache-busting timestamp
                                    const timestamp = new Date().getTime();
                                    const response = await fetch(`/api/weather/?location=${currentLocation}&latitude=${currentLatitude}&longitude=${currentLongitude}&t=${timestamp}`);
                                    const data = await response.json();
                                    
                                    console.log('Weather Data for', currentLocation, ':', data);
                                    
                                    if (data.current_weather) {
                                        container.innerHTML = `
                                            <div class="real-time-header">
                                                <h4>üå§Ô∏è ‡§Æ‡•å‡§∏‡§Æ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä - ${data.location}</h4>
                                                <p class="data-source">üìä ‡§∏‡•ç‡§∞‡•ã‡§§: ${data.data_source}</p>
                                                <p class="timestamp">üïí ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§Ö‡§™‡§°‡•á‡§ü: ${new Date(data.timestamp).toLocaleString('hi-IN')}</p>
                                            </div>
                                            
                                            <!-- Current Weather -->
            < div class="weather-card" >
                <div class="current-weather">
                    <div class="weather-main">
                        <h5>üå°Ô∏è ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§Æ‡•å‡§∏‡§Æ</h5>
                        <div class="weather-temp">${data.current_weather.temperature || '28¬∞C'}</div>
                        <div class="weather-condition">${data.current_weather.condition || '‡§∏‡§æ‡§´ ‡§Ü‡§∏‡§Æ‡§æ‡§®'}</div>
                        <div class="weather-feels-like">‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§π‡•ã ‡§∞‡§π‡§æ: ${data.current_weather.feels_like || '30¬∞C'}</div>
                    </div>
                    <div class="weather-details">
                        <div class="detail-item">
                            <span class="icon">üíß</span>
                            <span class="label">‡§Ü‡§∞‡•ç‡§¶‡•ç‡§∞‡§§‡§æ:</span>
                            <span class="value">${data.current_weather.humidity || '65%'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="icon">üí®</span>
                            <span class="label">‡§π‡§µ‡§æ ‡§ï‡•Ä ‡§ó‡§§‡§ø:</span>
                            <span class="value">${data.current_weather.wind_speed || '12 km/h'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="icon">üß≠</span>
                            <span class="label">‡§π‡§µ‡§æ ‡§ï‡•Ä ‡§¶‡§ø‡§∂‡§æ:</span>
                            <span class="value">${data.current_weather.wind_direction || '‡§â‡§§‡•ç‡§§‡§∞-‡§™‡•Ç‡§∞‡•ç‡§µ'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="icon">üìä</span>
                            <span class="label">‡§¶‡§¨‡§æ‡§µ:</span>
                            <span class="value">${data.current_weather.pressure || '1013'} ${data.current_weather.pressure_unit || 'hPa'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="icon">üëÅÔ∏è</span>
                            <span class="label">‡§¶‡•É‡§∂‡•ç‡§Ø‡§§‡§æ:</span>
                            <span class="value">${data.current_weather.visibility || '10'} ${data.current_weather.visibility_unit || 'km'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="icon">‚òÄÔ∏è</span>
                            <span class="label">UV ‡§∏‡•Ç‡§ö‡§ï‡§æ‡§Ç‡§ï:</span>
                            <span class="value">${data.current_weather.uv_index || '5'}</span>
                        </div>
                    </div>
                </div>
                </div >
                                        
                                            </div >
                                        
                                        < !--Agricultural Advice-- >
                                        <div class="weather-card">
                                            <h5>üåæ ‡§ï‡•É‡§∑‡§ø ‡§∏‡•Å‡§ù‡§æ‡§µ</h5>
                                            <div class="agricultural-advice">
                                                <p>${data.agricultural_advice || '‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ï‡•É‡§∑‡§ø ‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø‡§Ø‡§æ‡§Ç ‡§ú‡§æ‡§∞‡•Ä ‡§∞‡§ñ‡•á‡§Ç'}</p>
                                            </div>
                                        </div>
                                        
                                        <!--Weather Forecast-- >
                                        <div class="weather-card">
                                            <h5>üìÖ 7 ‡§¶‡§ø‡§® ‡§ï‡§æ ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§®‡•Å‡§Æ‡§æ‡§®</h5>
                                            <div class="forecast-grid">
                                                ${data.forecast_7_days ? data.forecast_7_days.map(day => `
                                                    <div class="forecast-item">
                                                        <div class="forecast-day">${day.day || day.date}</div>
                                                        <div class="forecast-temp">${day.temperature || '28¬∞C'}</div>
                                                        <div class="forecast-condition">${day.condition || '‡§∏‡§æ‡§´ ‡§Ü‡§∏‡§Æ‡§æ‡§®'}</div>
                                                        <div class="forecast-humidity">${day.humidity || '65%'}</div>
                                                        <div class="forecast-wind">${day.wind_speed || '12 km/h'}</div>
                                                    </div>
                                                `).join('') : '<p>‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§®‡•Å‡§Æ‡§æ‡§® ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç</p>'}
                                            </div>
                                        </div>
                                        
                                        <!--Weather Alerts-- >
                                        <div class="weather-card">
                                            <h5>‚ö†Ô∏è ‡§Æ‡•å‡§∏‡§Æ ‡§ö‡•á‡§§‡§æ‡§µ‡§®‡•Ä</h5>
                                            <div class="alerts-list">
                                                ${data.alerts ? data.alerts.map(alert => `
                                                    <div class="alert-item alert-${alert.severity}">
                                                        <span class="alert-type">${alert.type}:</span>
                                                        <span class="alert-message">${alert.message}</span>
                                                    </div>
                                                `).join('') : '<p>‡§ï‡•ã‡§à ‡§ö‡•á‡§§‡§æ‡§µ‡§®‡•Ä ‡§®‡§π‡•Ä‡§Ç</p>'}
                                            </div>
                                        </div>
                                            <h5>üìÖ 5-‡§¶‡§ø‡§® ‡§ï‡§æ ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§®‡•Å‡§Æ‡§æ‡§®</h5>
                                            <div class="forecast-grid">
                                                ${data.forecast.map(day => `
                                                    <div class="forecast-item">
                                                        <div class="forecast-day">${day.day}</div>
                                                        <div class="forecast-date">${day.date}</div>
                                                        <div class="forecast-temp">
                                                            <span class="temp-max">${day.temp_max}${day.temp_unit}</span>
                                                            <span class="temp-min">${day.temp_min}${day.temp_unit}</span>
                                                        </div>
                                                        <div class="forecast-condition">${day.condition}</div>
                                                        <div class="forecast-details">
                                                            <div class="forecast-detail">
                                                        <span class="icon">üíß</span>
                                                                <span>${day.humidity}%</span>
                                                    </div>
                                                            <div class="forecast-detail">
                                                                <span class="icon">üí®</span>
                                                                <span>${day.wind_speed} km/h</span>
                                                    </div>
                                                            <div class="forecast-detail">
                                                                <span class="icon">üåßÔ∏è</span>
                                                                <span>${day.rain_probability}%</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                `).join('')}
                                            </div>
                                        </div >
                                        
                                        < !--Farmer Advice-- >
                                        <div class="weather-card">
                                            <h5>üë®‚Äçüåæ ‡§ï‡§ø‡§∏‡§æ‡§® ‡§∏‡§≤‡§æ‡§π</h5>
                                            <div class="advice-section">
                                                <div class="advice-item">
                                                        <span class="icon">üåæ</span>
                                                    <span class="advice-text">${data.farmer_advice.general}</span>
                                                    </div>
                                                <div class="advice-item">
                                                    <span class="icon">üå±</span>
                                                    <span class="advice-text">${data.farmer_advice.crop_specific}</span>
                                                </div>
                                                <div class="advice-item">
                                                    <span class="icon">‚ö†Ô∏è</span>
                                                    <span class="advice-text">${data.farmer_advice.precautions}</span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!--Weather Alerts-- >
            <div class="weather-card">
                <h5>üö® ‡§Æ‡•å‡§∏‡§Æ ‡§ö‡•á‡§§‡§æ‡§µ‡§®‡•Ä</h5>
                <div class="alerts-section">
                    ${data.alerts.map(alert => `
                                                    <div class="alert-item alert-${alert.severity}">
                                                        <span class="alert-icon">${alert.severity === 'high' ? 'üî¥' : alert.severity === 'medium' ? 'üü°' : 'üü¢'}</span>
                                                        <span class="alert-type">${alert.type}</span>
                                                        <span class="alert-message">${alert.message}</span>
                                                    </div>
                                                `).join('')}
                </div>
            </div>
        `;
                                } else {
                                    container.innerHTML = `
            < div class="real-time-header" >
                                            <h4>üå§Ô∏è ‡§Æ‡•å‡§∏‡§Æ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä - ${currentLocation}</h4>
                                            <p class="data-source">üìä ‡§∏‡•ç‡§∞‡•ã‡§§: IMD (Indian Meteorological Department)</p>
                                        </div >
            <div class="weather-card">
                <h5>üå°Ô∏è ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§Æ‡•å‡§∏‡§Æ</h5>
                <div class="weather-temp">28¬∞C</div>
                <div class="weather-condition">‡§∏‡§æ‡§´ ‡§Ü‡§∏‡§Æ‡§æ‡§®</div>
                <div class="weather-details">
                    <div class="detail-item">
                        <span class="icon">üíß</span>
                        <span class="label">‡§Ü‡§∞‡•ç‡§¶‡•ç‡§∞‡§§‡§æ:</span>
                        <span class="value">65%</span>
                    </div>
                    <div class="detail-item">
                        <span class="icon">üí®</span>
                        <span class="label">‡§π‡§µ‡§æ ‡§ï‡•Ä ‡§ó‡§§‡§ø:</span>
                        <span class="value">12 km/h</span>
                    </div>
                </div>
            </div>
        `;
                                }
                            } catch (error) {
                                console.error('Error loading weather:', error);
                                container.innerHTML = `
            < div class="real-time-header" >
                                        <h4>üå§Ô∏è ‡§Æ‡•å‡§∏‡§Æ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä - ${currentLocation}</h4>
                                        <p class="data-source">üìä ‡§∏‡•ç‡§∞‡•ã‡§§: IMD (Indian Meteorological Department)</p>
                                    </div >
            <div class="weather-card">
                <h5>üå°Ô∏è ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§Æ‡•å‡§∏‡§Æ</h5>
                <div class="weather-temp">28¬∞C</div>
                <div class="weather-condition">‡§∏‡§æ‡§´ ‡§Ü‡§∏‡§Æ‡§æ‡§®</div>
                <div class="weather-details">
                    <div class="detail-item">
                        <span class="icon">üíß</span>
                        <span class="label">‡§Ü‡§∞‡•ç‡§¶‡•ç‡§∞‡§§‡§æ:</span>
                        <span class="value">65%</span>
                    </div>
                    <div class="detail-item">
                        <span class="icon">üí®</span>
                        <span class="label">‡§π‡§µ‡§æ ‡§ï‡•Ä ‡§ó‡§§‡§ø:</span>
                        <span class="value">12 km/h</span>
                    </div>
                </div>
            </div>
        `;
                            }
                        }
        */
        */

        // Force reload market prices with cache busting
        /* COMMENTED OUT - Using enhanced_services.js instead
        /* COMMENTED OUT - Using enhanced_services.js instead
                        function forceReloadMarketPrices() {
                            console.log('Force reloading market prices...');
                            const container = document.getElementById('pricesData');
                            container.innerHTML = '<div class="loading">‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</div>';
                            
                            // Clear any cached data
                            if ('caches' in window) {
                                caches.keys().then(function(names) {
                                    for (let name of names) {
                                        caches.delete(name);
                                    }
                                });
                            }
                            
                            // Reload with fresh data
                            setTimeout(() => {
                                loadMarketPrices();
                            }, 100);
                        }
        */
        */
        
        // Load Market Prices - Ultra-Dynamic Real-Time Agmarknet/e-NAM Data (v2.0)
        /* COMMENTED OUT - Using enhanced_services.js instead
        /* COMMENTED OUT - Using enhanced_services.js instead
                        async function loadMarketPrices() {
                            const container = document.getElementById('pricesData');
                            
                            try {
                                // Add cache-busting timestamp and version
                                const timestamp = new Date().getTime();
                                const version = 'v2.0';
                                const response = await fetch(`/ api / market - prices /? location = ${ currentLocation }& latitude=${ currentLatitude }& longitude=${ currentLongitude }& t=${ timestamp }& v=${ version } `);
                                const data = await response.json();
                                
                                console.log('Market Prices Data:', data);
                                console.log('Crops Data:', data.crops ? data.crops.length : 'No crops');
                                console.log('Nearest Mandis:', data.nearest_mandis_data ? data.nearest_mandis_data.length : 'No mandis');
                                
                                // Store market data globally for mandi selection
                                currentMarketData = data;
                                
                                // Auto-select nearest mandi if available
                                if (data.auto_selected_mandi && !selectedMandi) {
                                    selectedMandi = data.auto_selected_mandi;
                                    const mandiDropdown = document.getElementById('mandiDropdown');
                                    if (mandiDropdown) {
                                        mandiDropdown.value = selectedMandi;
                                        // Trigger change event to load mandi-specific prices
                                        mandiDropdown.dispatchEvent(new Event('change'));
                                    }
                                }
                                
                                // Force square box layout for all cases
                                if (data.market_data && data.market_data.top_crops && data.market_data.top_crops.length > 0) {
                                    container.innerHTML = `
            < div class="real-time-header" >
                                            <h4>üí∞ ‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§≠‡§æ‡§µ - ${data.location}</h4>
                                            <p class="data-source">üìä ‡§∏‡•ç‡§∞‡•ã‡§§: ${data.data_source}</p>
                                            <p class="timestamp">üïí ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§Ö‡§™‡§°‡•á‡§ü: ${new Date(data.timestamp).toLocaleString('hi-IN')}</p>
                                        </div >
                                        
                                        < !--Mandi Selection Section-- >
                                        <div class="mandi-search-container">
                                            <h5>üè™ ‡§®‡§ø‡§ï‡§ü‡§§‡§Æ ‡§Æ‡§Ç‡§°‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç</h5>
                                            <div class="mandi-selection-container">
                                                <div class="mandi-dropdown-container">
                                                    <label for="mandiDropdown">üìç ‡§Æ‡§Ç‡§°‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç (‡§∏‡•ç‡§•‡§æ‡§® ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞)</label>
                                                    <select id="mandiDropdown" class="form-control mandi-dropdown" onchange="updatePricesForSelectedMandi()">
                                                        <option value="">‡§Æ‡§Ç‡§°‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç...</option>
                                                        ${data.market_data.nearby_mandis ? data.market_data.nearby_mandis.map(mandi => `
                                                            <option value="${mandi.name}">
                                                                ${mandi.name} - ${mandi.distance} - ${mandi.status}
                                                            </option>
                                                        `).join('') : ''}
                                                </select>
                                                    <div class="mandi-info-text">
                                                        <small class="text-muted">üìç ${data.location} ‡§ï‡•á ‡§®‡§ø‡§ï‡§ü‡§§‡§Æ ‡§Æ‡§Ç‡§°‡•Ä</small>
                                                    </div>
                                                </div>
                                                
                                                <!-- Crop Filter Box -->
                                                <div class="crop-filter-container">
                                                    <label for="cropFilter">üåæ ‡§´‡§∏‡§≤ ‡§´‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç</label>
                                                    <input type="text" id="cropFilter" placeholder="‡§´‡§∏‡§≤ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç (‡§ú‡•à‡§∏‡•á: ‡§ó‡•á‡§π‡•Ç‡§Ç, ‡§ö‡§æ‡§µ‡§≤)" class="form-control" onkeyup="filterCrops()">
                                            </div>
                                        </div>
                                                    </div>
                                    
                                        <div class="mandi-prices-grid">
                                            ${data.market_data.top_crops.map(crop => `
                                                <div class="mandi-price-square">
                                                    <div class="square-header">
                                                        <h6>üåæ ${crop.crop_name_hindi || crop.crop_name}</h6>
                                                        <span class="trend-icon">${crop.trend === '‡§¨‡§¢‡§º ‡§∞‡§π‡§æ' ? 'üìà' : crop.trend === '‡§ó‡§ø‡§∞ ‡§∞‡§π‡§æ' ? 'üìâ' : 'üìä'}</span>
                                                </div>
                                                    <div class="square-content">
                                                        <div class="price-main">
                                                            <span class="current-price">${crop.current_price}</span>
                                                        </div>
                                                        <div class="price-details">
                                                            <div class="detail-row">
                                                                <span class="label">MSP:</span>
                                                                <span class="value">${crop.msp}</span>
                                                            </div>
                                                            <div class="detail-row">
                                                                <span class="label">‡§≤‡§æ‡§≠:</span>
                                                                <span class="value profit">${crop.profit}</span>
                                                            </div>
                                                            <div class="detail-row">
                                                                <span class="label">%:</span>
                                                                <span class="value profit-percent">${crop.profit_percentage}</span>
                                                            </div>
                                                            <div class="detail-row">
                                                                <span class="label">‡§Æ‡§æ‡§Ç‡§ó:</span>
                                                                <span class="value">${crop.demand}</span>
                                                        </div>
                                                            <div class="detail-row">
                                                                <span class="label">‡§Ü‡§™‡•Ç‡§∞‡•ç‡§§‡§ø:</span>
                                                                <span class="value">${crop.supply}</span>
                                                        </div>
                                                    </div>
                                                        <div class="mandi-info">
                                                            <span class="mandi-name">${data.mandi || 'Delhi Mandi'}</span>
                                                            <span class="date">${new Date(data.timestamp).toLocaleDateString('hi-IN')}</span>
                                                </div>
                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
        `;
                                } else {
                                    // Fallback with square box layout
                                    container.innerHTML = `
            < div class="real-time-header" >
                                            <h4>üí∞ ‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§≠‡§æ‡§µ - ${currentLocation}</h4>
                                            <p class="data-source">üìä ‡§∏‡•ç‡§∞‡•ã‡§§: Ultra-Dynamic Government APIs</p>
                                        </div >
                                        
                                        < !--Mandi Selection Section-- >
                                        <div class="mandi-search-container">
                                            <h5>üè™ ‡§®‡§ø‡§ï‡§ü‡§§‡§Æ ‡§Æ‡§Ç‡§°‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç</h5>
                                            <div class="mandi-selection-container">
                                                <div class="mandi-dropdown-container">
                                                    <label for="mandiDropdown">üìç ‡§Æ‡§Ç‡§°‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç (‡§∏‡•ç‡§•‡§æ‡§® ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞)</label>
                                                    <select id="mandiDropdown" class="form-control mandi-dropdown" onchange="updatePricesForSelectedMandi()">
                                                        <option value="">‡§Æ‡§Ç‡§°‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç...</option>
                                                        ${data.nearest_mandis_data ? data.nearest_mandis_data.map(mandi => `
                                                            <option value="${mandi.name}" ${mandi.auto_selected ? 'data-auto-selected="true"' : ''}>
                                                                ${mandi.name} ${mandi.auto_selected ? '(‡§®‡§ø‡§ï‡§ü‡§§‡§Æ)' : ''} - ${mandi.distance} - ${mandi.specialty}
                                                            </option>
                                                        `).join('') : ''}
                                        </select>
                                                    <div class="mandi-info-text">
                                                        <small class="text-muted">üìç ${data.location} ‡§ï‡•á ‡§®‡§ø‡§ï‡§ü‡§§‡§Æ ‡§Æ‡§Ç‡§°‡•Ä</small>
                                                    </div>
                                                    </div>
                                                
                                                <!-- Crop Filter Box -->
                                                <div class="crop-filter-container">
                                                    <label for="cropFilter">üåæ ‡§´‡§∏‡§≤ ‡§´‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç</label>
                                                    <input type="text" id="cropFilter" placeholder="‡§´‡§∏‡§≤ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç (‡§ú‡•à‡§∏‡•á: ‡§ó‡•á‡§π‡•Ç‡§Ç, ‡§ö‡§æ‡§µ‡§≤)" class="form-control" onkeyup="filterCrops()">
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="mandi-prices-grid">
                                            <div class="mandi-price-square">
                                                <div class="square-header">
                                                    <h6>üåæ ‡§ó‡•á‡§π‡•Ç‡§Ç</h6>
                                                    <span class="trend-icon">üìà</span>
                                                </div>
                                                <div class="square-content">
                                                    <div class="price-main">
                                                        <span class="current-price">‚Çπ2,500</span>
                                                        <span class="price-unit">/quintal</span>
                                                    </div>
                                                    <div class="price-details">
                                                        <div class="detail-row">
                                                            <span class="label">MSP:</span>
                                                            <span class="value">‚Çπ2,000</span>
                                                        </div>
                                                        <div class="detail-row">
                                                            <span class="label">‡§≤‡§æ‡§≠:</span>
                                                            <span class="value profit">‚Çπ500</span>
                                                        </div>
                                                        <div class="detail-row">
                                                            <span class="label">%:</span>
                                                            <span class="value profit-percent">25%</span>
                                                        </div>
                                                    </div>
                                                    <div class="mandi-info">
                                                        <span class="mandi-name">Delhi Mandi</span>
                                                        <span class="date">${new Date().toLocaleDateString('hi-IN')}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
        `;
                                }
                            } catch (error) {
                                console.error('Error loading prices:', error);
                                container.innerHTML = `
            < div class="real-time-header" >
                                        <h4>üí∞ ‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§≠‡§æ‡§µ - ${currentLocation}</h4>
                                        <p class="data-source">üìä ‡§∏‡•ç‡§∞‡•ã‡§§: Ultra-Dynamic Government APIs</p>
                                    </div >
            <div class="price-card">
                <div class="price-header">
                    <h5>üåæ ‡§ó‡•á‡§π‡•Ç‡§Ç</h5>
                    <span class="price-trend trend-up">üìà</span>
                </div>
                <div class="price-details">
                    <div class="price-item">
                        <span class="label">üí∞ ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§≠‡§æ‡§µ:</span>
                        <span class="value current-price">‚Çπ2,500/quintal</span>
                    </div>
                    <div class="price-item">
                        <span class="label">üèõÔ∏è ‡§®‡•ç‡§Ø‡•Ç‡§®‡§§‡§Æ ‡§∏‡§Æ‡§∞‡•ç‡§•‡§® ‡§Æ‡•Ç‡§≤‡•ç‡§Ø:</span>
                        <span class="value msp-price">‚Çπ2,000/quintal</span>
                    </div>
                </div>
            </div>
        `;
                            }
                        }
        */
        */
        
        // Mandi Search Functions
        async function searchMandiByLocation() {
            const locationInput = document.getElementById('mandiLocationSearch');
            const resultsContainer = document.getElementById('mandiSearchResults');
            
            if (!locationInput.value.trim()) {
                showNotification('‡§ï‡•É‡§™‡§Ø‡§æ ‡§Æ‡§Ç‡§°‡•Ä ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§Ø‡§æ ‡§∏‡•ç‡§•‡§æ‡§® ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç', 'warning');
                return;
            }
            
            try {
                resultsContainer.innerHTML = '<div class="loading">‡§Æ‡§Ç‡§°‡•Ä ‡§ñ‡•ã‡§ú ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...</div>';
                
                // Search for mandis in the specified location
                const response = await fetch(`/ api / realtime - gov / mandi_search /? location = ${ encodeURIComponent(locationInput.value) }& latitude=${ currentLatitude }& longitude=${ currentLongitude } `);
                const data = await response.json();
                
                if (data.mandi_data) {
                    resultsContainer.innerHTML = `
            < div class="mandi-results-summary" >
                            <h6>üìç ${data.location} ‡§Æ‡•á‡§Ç ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§Æ‡§Ç‡§°‡§ø‡§Ø‡§æ‡§Ç (${data.total_crops} ‡§´‡§∏‡§≤‡•á‡§Ç)</h6>
                            <div class="mandi-grid">
                                ${Object.entries(data.mandi_data).map(([cropName, mandiInfo]) => `
                                    <div class="mandi-summary-square">
                                        <div class="square-header">
                                            <h6>üåæ ${mandiInfo.crop_name}</h6>
                                        </div>
                                        <div class="square-content">
                                            <div class="price-main">
                                                <span class="current-price">‚Çπ${mandiInfo.current_price?.toLocaleString('hi-IN')}</span>
                                                <span class="price-unit">/quintal</span>
                                            </div>
                                            <div class="mandi-name">${mandiInfo.mandi_name}</div>
                                            <div class="profit-info">
                                                <span class="profit">‡§≤‡§æ‡§≠: ‚Çπ${mandiInfo.profit_margin?.toLocaleString('hi-IN')}</span>
                                                <span class="profit-percent">${mandiInfo.profit_percentage}%</span>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div >
            `;
                } else {
                    resultsContainer.innerHTML = '<div class="no-results">‡§á‡§∏ ‡§∏‡•ç‡§•‡§æ‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Æ‡§Ç‡§°‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à</div>';
                }
                
            } catch (error) {
                console.error('Mandi location search error:', error);
                resultsContainer.innerHTML = '<div class="error">‡§Æ‡§Ç‡§°‡•Ä ‡§ñ‡•ã‡§ú ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§π‡•Å‡§à</div>';
                showNotification('‡§Æ‡§Ç‡§°‡•Ä ‡§ñ‡•ã‡§ú ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§π‡•Å‡§à', 'error');
            }
        }
        
        async function searchCropFromMandi() {
            const cropInput = document.getElementById('mandiCropSearch');
            const resultsContainer = document.getElementById('mandiSearchResults');
            
            if (!cropInput.value.trim()) {
                showNotification('‡§ï‡•É‡§™‡§Ø‡§æ ‡§´‡§∏‡§≤ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç', 'warning');
                return;
            }
            
            try {
                resultsContainer.innerHTML = '<div class="loading">‡§´‡§∏‡§≤ ‡§ñ‡•ã‡§ú ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...</div>';
                
                const response = await fetch(`/ api / realtime - gov / mandi_search /? location = ${ currentLocation }& crop=${ encodeURIComponent(cropInput.value) }& latitude=${ currentLatitude }& longitude=${ currentLongitude } `);
                const data = await response.json();
                
                if (data.mandi_info) {
                    const mandiInfo = data.mandi_info;
                    resultsContainer.innerHTML = `
            < div class="crop-result-card" >
                            <h6>üåæ ${mandiInfo.crop_name} - ${mandiInfo.mandi_name}</h6>
                            <div class="crop-details-grid">
                                <div class="crop-detail-square">
                                    <div class="detail-label">üí∞ ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§≠‡§æ‡§µ</div>
                                    <div class="detail-value">‚Çπ${mandiInfo.current_price?.toLocaleString('hi-IN')}/quintal</div>
                                </div>
                                <div class="crop-detail-square">
                                    <div class="detail-label">üèõÔ∏è ‡§®‡•ç‡§Ø‡•Ç‡§®‡§§‡§Æ ‡§∏‡§Æ‡§∞‡•ç‡§•‡§® ‡§Æ‡•Ç‡§≤‡•ç‡§Ø</div>
                                    <div class="detail-value">‚Çπ${mandiInfo.msp?.toLocaleString('hi-IN')}/quintal</div>
                                </div>
                                <div class="crop-detail-square">
                                    <div class="detail-label">üìà ‡§≤‡§æ‡§≠ ‡§Æ‡§æ‡§∞‡•ç‡§ú‡§ø‡§®</div>
                                    <div class="detail-value profit">‚Çπ${mandiInfo.profit_margin?.toLocaleString('hi-IN')}/quintal</div>
                                </div>
                                <div class="crop-detail-square">
                                    <div class="detail-label">üìä ‡§≤‡§æ‡§≠ ‡§™‡•ç‡§∞‡§§‡§ø‡§∂‡§§</div>
                                    <div class="detail-value profit-percent">${mandiInfo.profit_percentage}%</div>
                                </div>
                                <div class="crop-detail-square">
                                    <div class="detail-label">üìç ‡§Æ‡§Ç‡§°‡•Ä ‡§¶‡•Ç‡§∞‡•Ä</div>
                                    <div class="detail-value">${mandiInfo.mandi_distance}</div>
                                </div>
                                <div class="crop-detail-square">
                                    <div class="detail-label">üè™ ‡§Æ‡§Ç‡§°‡•Ä ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞</div>
                                    <div class="detail-value">${mandiInfo.mandi_type}</div>
                                </div>
                            </div>
                        </div >
            `;
                } else {
                    resultsContainer.innerHTML = '<div class="no-results">‡§á‡§∏ ‡§´‡§∏‡§≤ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Æ‡§Ç‡§°‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à</div>';
                }
                
            } catch (error) {
                console.error('Crop search error:', error);
                resultsContainer.innerHTML = '<div class="error">‡§´‡§∏‡§≤ ‡§ñ‡•ã‡§ú ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§π‡•Å‡§à</div>';
                showNotification('‡§´‡§∏‡§≤ ‡§ñ‡•ã‡§ú ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§π‡•Å‡§à', 'error');
            }
        }
        
        // Handle Image Upload for Pest Detection
        document.getElementById('pestImageForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const container = document.getElementById('pestData');
            const imageFile = document.getElementById('cropImage').files[0];
            const cropName = document.getElementById('cropName').value;
            const symptoms = document.getElementById('symptoms').value;
            
            if (!imageFile) {
                showNotification('‡§ï‡•É‡§™‡§Ø‡§æ ‡§è‡§ï ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç', 'warning');
                return;
            }
            
            try {
                container.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i><p>‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§ï‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</p></div>';
                
                const formData = new FormData();
                formData.append('image', imageFile);
                formData.append('crop', cropName);
                formData.append('location', currentLocation);
                formData.append('latitude', currentLatitude);
                formData.append('longitude', currentLongitude);
                formData.append('symptoms', symptoms);
                
                const response = await fetch('/api/realtime-gov/pest_detection/', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                displayPestAnalysis(data, true);
                
            } catch (error) {
                console.error('Image analysis error:', error);
                container.innerHTML = '<div class="error-message">‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§π‡•Å‡§à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§</div>';
                showNotification('‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§π‡•Å‡§à', 'error');
            }
        });
        
        // Display Pest Analysis Results
        function displayPestAnalysis(data, isImageAnalysis = false) {
            const container = document.getElementById('pestData');
            
            if (isImageAnalysis && data.pest_analysis && data.pest_analysis.image_analysis) {
                const imageAnalysis = data.pest_analysis.image_analysis;
                const analysisResult = imageAnalysis.analysis_result;
                
                container.innerHTML = `
            < div class="pest-analysis-container" >
                        <div class="analysis-header">
                            <h4>üîç ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ</h4>
                            <p class="data-source">üìä ‡§∏‡•ç‡§∞‡•ã‡§§: ${data.data_source}</p>
                            <p class="timestamp">üïí ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§Ö‡§™‡§°‡•á‡§ü: ${new Date(data.timestamp).toLocaleString('hi-IN')}</p>
                        </div>
                        
                        <div class="image-analysis-result">
                            <div class="analysis-card">
                                <h5>üåæ ${analysisResult.disease_name_hindi || '‡§∞‡•ã‡§ó ‡§ï‡§æ ‡§®‡§æ‡§Æ'}</h5>
                                <div class="analysis-details">
                                    <div class="detail-item">
                                        <span class="label">‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§∏‡•ç‡§§‡§∞:</span>
                                        <span class="value">${Math.round((analysisResult.confidence || 0) * 100)}%</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="label">‡§ó‡§Ç‡§≠‡•Ä‡§∞‡§§‡§æ:</span>
                                        <span class="value ${analysisResult.severity}">${analysisResult.severity || '‡§Æ‡§ß‡•ç‡§Ø‡§Æ'}</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="label">‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡§ø‡§§ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞:</span>
                                        <span class="value">${analysisResult.affected_area || '‡§Ö‡§ú‡•ç‡§û‡§æ‡§§'}</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="label">‡§â‡§™‡§ö‡§æ‡§∞ ‡§ï‡•Ä ‡§§‡§æ‡§§‡•ç‡§ï‡§æ‡§≤‡§ø‡§ï‡§§‡§æ:</span>
                                        <span class="value ${analysisResult.treatment_urgency}">${analysisResult.treatment_urgency || '‡§Æ‡§ß‡•ç‡§Ø‡§Æ'}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="treatment-recommendations">
                                <h5>üíä ‡§â‡§™‡§ö‡§æ‡§∞ ‡§∏‡•Å‡§ù‡§æ‡§µ</h5>
                                <div class="recommendations-grid">
                                    ${(analysisResult.recommendations || []).map(rec => `
                                        <div class="recommendation-card">
                                            <h6>${rec.treatment}</h6>
                                            <p><strong>‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ:</strong> ${rec.dosage}</p>
                                            <p><strong>‡§Ü‡§µ‡•É‡§§‡•ç‡§§‡§ø:</strong> ${rec.frequency}</p>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div >
            `;
            } else {
                // Regular pest analysis display
                container.innerHTML = `
            < div class="pest-analysis-container" >
                        <div class="analysis-header">
                            <h4>üêõ ‡§ï‡•Ä‡§ü ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä</h4>
                            <p class="data-source">üìä ‡§∏‡•ç‡§∞‡•ã‡§§: ${data.data_source}</p>
                            <p class="timestamp">üïí ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§Ö‡§™‡§°‡•á‡§ü: ${new Date(data.timestamp).toLocaleString('hi-IN')}</p>
                        </div>
                        
                        <div class="pest-info-grid">
                            <div class="pest-category">
                                <h5>üêõ ‡§ï‡•Ä‡§ü</h5>
                                ${(data.pest_analysis?.pests || []).map(pest => `
                                    <div class="pest-item">
                                        <h6>${pest.name_hindi} (${pest.name})</h6>
                                        <p><strong>‡§ó‡§Ç‡§≠‡•Ä‡§∞‡§§‡§æ:</strong> ${pest.severity}</p>
                                        <p><strong>‡§µ‡§ø‡§µ‡§∞‡§£:</strong> ${pest.description}</p>
                                        <p><strong>‡§â‡§™‡§ö‡§æ‡§∞:</strong> ${pest.treatment}</p>
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div class="disease-category">
                                <h5>ü¶† ‡§∞‡•ã‡§ó</h5>
                                ${(data.pest_analysis?.diseases || []).map(disease => `
                                    <div class="disease-item">
                                        <h6>${disease.name_hindi} (${disease.name})</h6>
                                        <p><strong>‡§ó‡§Ç‡§≠‡•Ä‡§∞‡§§‡§æ:</strong> ${disease.severity}</p>
                                        <p><strong>‡§µ‡§ø‡§µ‡§∞‡§£:</strong> ${disease.description}</p>
                                        <p><strong>‡§â‡§™‡§ö‡§æ‡§∞:</strong> ${disease.treatment}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div >
            `;
            }
        }
        
        // Load Pest Control
        async function loadPestControl() {
            const container = document.getElementById('pestData');
            
            try {
                // Add cache-busting timestamp
                const timestamp = new Date().getTime();
                const response = await fetch(`/ api / realtime - gov / pest_detection /? t = ${ timestamp } `, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        crop: 'wheat',
                        location: currentLocation,
                        latitude: currentLatitude,
                        longitude: currentLongitude,
                        symptoms: ''
                    })
                });
                const data = await response.json();
                
                console.log('Pest Control Data for', currentLocation, ':', data);
                displayPestAnalysis(data, false);
            } catch (error) {
                console.error('Error loading pest control:', error);
                container.innerHTML = '<div class="data-card"><h5>üêõ ‡§ï‡•Ä‡§ü ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£</h5><p>‡§∏‡•á‡§µ‡§æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§π‡•à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§¨‡§æ‡§¶ ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•á‡§Ç‡•§</p></div>';
            }
        }

        // Open Scheme Application
        function openSchemeApplication(url) {
            if (url && url !== 'undefined') {
                window.open(url, '_blank');
                showNotification('‡§Ø‡•ã‡§ú‡§®‡§æ ‡§ï‡•Ä ‡§Ü‡§ß‡§ø‡§ï‡§æ‡§∞‡§ø‡§ï ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü ‡§ñ‡•Å‡§≤ ‡§∞‡§π‡•Ä ‡§π‡•à...', 'info');
            } else {
                showNotification('‡§Ø‡•ã‡§ú‡§®‡§æ ‡§ï‡•Ä ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à', 'warning');
            }
        }
        
        // Open Government Scheme Website
        function openGovernmentScheme(url) {
            if (url && url !== 'undefined') {
                window.open(url, '_blank');
                showNotification('‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü ‡§ñ‡•Å‡§≤ ‡§∞‡§π‡•Ä ‡§π‡•à...', 'info');
            } else {
                showNotification('‡§Ü‡§ß‡§ø‡§ï‡§æ‡§∞‡§ø‡§ï ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à', 'warning');
            }
        }
        
        // Ask about scheme
        function askAboutScheme(schemeName) {
            const query = `${ schemeName } ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§∏‡•ç‡§§‡§æ‡§∞ ‡§∏‡•á ‡§¨‡§§‡§æ‡§è‡§Ç`;
            
            fetch('/api/chatbot/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    query: query,
                    language: 'hi',
                    session_id: sessionId
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.response) {
                    showNotification('‡§Ø‡•ã‡§ú‡§®‡§æ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§Æ‡§ø‡§≤ ‡§ó‡§à!', 'success');
                    alert(`${ schemeName } \n\n${ data.response } `);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('‡§Ø‡•ã‡§ú‡§®‡§æ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤ ‡§∏‡§ï‡•Ä', 'error');
            });
        }

        // Get pest advice
        function getPestAdvice() {
            const crop = document.getElementById('cropName').value;
            const problem = document.getElementById('problemDescription').value;
            
            if (!crop || !problem) {
                showNotification('‡§ï‡•É‡§™‡§Ø‡§æ ‡§´‡§∏‡§≤ ‡§î‡§∞ ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§ï‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§¶‡•á‡§Ç', 'error');
                return;
            }
            
            const query = `${ crop } ‡§Æ‡•á‡§Ç ${ problem } ‡§ï‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§π‡•à‡•§ ‡§á‡§∏‡§ï‡§æ ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§® ‡§¨‡§§‡§æ‡§è‡§Ç`;
            
            fetch('/api/chatbot/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    query: query,
                    language: 'hi',
                    session_id: sessionId
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.response) {
                    showNotification('‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§ï‡§æ ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§® ‡§Æ‡§ø‡§≤ ‡§ó‡§Ø‡§æ!', 'success');
                    alert(data.response);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§ï‡§æ ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§® ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤ ‡§∏‡§ï‡§æ', 'error');
            });
        }

        // Send message to AI
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addMessage(message, 'user');
            input.value = '';
            
            // Show loading
            document.getElementById('loading').style.display = 'block';
            
            // Send to API
            fetch('/api/chatbot/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    query: message,
                    language: 'hi',
                    session_id: sessionId,
                    location: currentLocation,
                    latitude: currentLatitude,
                    longitude: currentLongitude
                })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('loading').style.display = 'none';
                if (data.response) {
                    // Enhanced response with metadata
                    addMessage(data.response, 'bot', {
                        dataSource: data.data_source || 'intelligent_fallback',
                        confidence: data.confidence || 0.8,
                        modelUsed: data.model_used || 'KrishiMitra AI',
                        timestamp: data.timestamp,
                        governmentData: data.government_data_included
                    });
                } else {
                    addMessage('‡§ï‡•ç‡§∑‡§Æ‡§æ ‡§ï‡§∞‡•á‡§Ç, ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•á ‡§∏‡§µ‡§æ‡§≤ ‡§ï‡§æ ‡§ú‡§µ‡§æ‡§¨ ‡§®‡§π‡•Ä‡§Ç ‡§¶‡•á ‡§∏‡§ï‡§æ‡•§', 'bot');
                }
            })
            .catch(error => {
                document.getElementById('loading').style.display = 'none';
                console.error('Error:', error);
                addMessage('‡§ï‡•ç‡§∑‡§Æ‡§æ ‡§ï‡§∞‡•á‡§Ç, ‡§è‡§ï ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§π‡•Å‡§à ‡§π‡•à‡•§', 'bot');
            });
        }

        // Add message to chat
        function addMessage(text, sender) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${ sender } -message`;
            
            if (sender === 'user') {
                messageDiv.innerHTML = `< strong > ‡§Ü‡§™:</strong > ${ text } `;
            } else {
                messageDiv.innerHTML = `< strong > ‡§ï‡•É‡§∑‡§ø‡§Æ‡§ø‡§§‡•ç‡§∞ AI:</strong > ${ text } `;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${ type } `;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // Handle Enter key in message input
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Location Search Functions
        async function searchLocations(event) {
            const query = event.target.value.trim();
            console.log('Searching for location:', query);
            
            // Clear previous timeout
            if (locationSearchTimeout) {
                clearTimeout(locationSearchTimeout);
            }
            
            if (query.length < 2) {
                hideLocationSuggestions();
                return;
            }
            
            // Debounce search
            locationSearchTimeout = setTimeout(async () => {
                try {
                    console.log('Making API request for:', query);
                    const response = await fetch(`/ api / locations / search /? q = ${ encodeURIComponent(query) } `);
                    console.log('API response status:', response.status);
                    const data = await response.json();
                    console.log('API response data:', data);
                    
                    if (data.suggestions && data.suggestions.length > 0) {
                        showLocationSuggestions(data.suggestions);
                    } else {
                        hideLocationSuggestions();
                    }
                } catch (error) {
                    console.error('Location search error:', error);
                    hideLocationSuggestions();
                }
            }, 300);
        }
        
        function showLocationSuggestions(suggestions = null) {
            const container = document.getElementById('locationSuggestions');
            
            if (suggestions) {
                container.innerHTML = suggestions.map(suggestion => `
            < div class="location-suggestion" onclick = "selectLocation('${suggestion.name}', ${suggestion.lat}, ${suggestion.lon})" >
                        <div>
                            <div class="suggestion-name">${suggestion.name}</div>
                            <div class="suggestion-details">${suggestion.state || ''} ${suggestion.region || ''}</div>
                        </div>
                        <div class="suggestion-details">${suggestion.type || 'location'}</div>
                    </div >
            `).join('');
            }
            
            container.style.display = 'block';
        }
        
        function hideLocationSuggestions() {
            const container = document.getElementById('locationSuggestions');
            container.style.display = 'none';
        }
        
        function selectLocation(name, lat, lon) {
            console.log('Selecting location:', name, lat, lon);
            
            // Update global location variables
            currentLocation = name;
            currentLatitude = lat;
            currentLongitude = lon;
            
            // Verify the update
            console.log('Location variables updated:', {
                currentLocation: currentLocation,
                currentLatitude: currentLatitude,
                currentLongitude: currentLongitude
            });
            
            // Update display
            document.getElementById('currentLocationDisplay').textContent = name;
            document.getElementById('locationSearchInput').value = '';
            
            // Hide suggestions
            hideLocationSuggestions();
            
            // Show notification
            showNotification(`‡§∏‡•ç‡§•‡§æ‡§® ‡§¨‡§¶‡§≤‡§æ ‡§ó‡§Ø‡§æ: ${ name } `, 'success');
            
            // Reload all services with new location
            console.log('Reloading all services with new location:', name);
            reloadAllServices();
        }
        
        function searchCurrentLocation() {
            const input = document.getElementById('locationSearchInput');
            if (input.value.trim()) {
                searchLocations({ target: input });
            }
        }
        
        function detectLocation() {
            if (navigator.geolocation) {
                showNotification('‡§∏‡•ç‡§•‡§æ‡§® ‡§ï‡§æ ‡§™‡§§‡§æ ‡§≤‡§ó‡§æ‡§Ø‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à...', 'info');
                
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        
                        // Reverse geocoding to get location name
                        fetch(`/ api / locations / reverse /? lat = ${ lat }& lon=${ lon } `)
                            .then(response => response.json())
                            .then(data => {
                                if (data.location) {
                                    selectLocation(data.location, lat, lon);
                                } else {
                                    selectLocation('Detected Location', lat, lon);
                                }
                            })
                            .catch(() => {
                                selectLocation('Detected Location', lat, lon);
                            });
                    },
                    function(error) {
                        showNotification('‡§∏‡•ç‡§•‡§æ‡§® ‡§ï‡§æ ‡§™‡§§‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§≤‡§ó‡§æ‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§æ', 'error');
                    }
                );
            } else {
                showNotification('‡§∏‡•ç‡§•‡§æ‡§® ‡§™‡§§‡§æ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§∏‡•Å‡§µ‡§ø‡§ß‡§æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à', 'error');
            }
        }
        
        /* COMMENTED OUT - Using enhanced_services.js instead
        /* COMMENTED OUT - Using enhanced_services.js instead
                        function reloadAllServices() {
                            console.log('üîÑ Reloading all services with location:', currentLocation, currentLatitude, currentLongitude);
                            
                            // Reload all service data with new location
                            const services = ['government-schemes', 'crop-recommendations', 'weather', 'market-prices', 'pest-control'];
                            
                            // Show loading notification
                            showNotification(`‡§∏‡•ç‡§•‡§æ‡§® ‡§¨‡§¶‡§≤ ‡§∞‡§π‡§æ ‡§π‡•à... ${ currentLocation } ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§≠‡•Ä ‡§∏‡•á‡§µ‡§æ‡§è‡§Ç ‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à‡§Ç`, 'info');
                            
                            // Clear all service containers first
                            const serviceContainers = {
                                'government-schemes': 'schemesData',
                                'crop-recommendations': 'cropsData', 
                                'weather': 'weatherData',
                                'market-prices': 'pricesData',
                                'pest-control': 'pestData'
                            };
                            
                            console.log('üßπ Clearing all service containers...');
                            services.forEach(serviceName => {
                                const containerId = serviceContainers[serviceName];
                                const container = document.getElementById(containerId);
                                if (container) {
                                    container.innerHTML = `< div class="loading" ><i class="fas fa-spinner fa-spin"></i><p>${currentLocation} ‡§ï‡•á ‡§≤‡§ø‡§è ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</p></div > `;
                                    console.log(`‚úÖ Cleared container: ${ containerId } `);
                                } else {
                                    console.error(`‚ùå Container not found: ${ containerId } `);
                                }
                            });
                            
                            // Reload each service with a small delay to prevent API overload
                            console.log('üîÑ Starting service reload sequence...');
                            services.forEach((serviceName, index) => {
                                setTimeout(() => {
                                    console.log(`üîÑ Reloading service: ${ serviceName } for location: ${ currentLocation } `);
                                    try {
                                    loadServiceData(serviceName);
                                        console.log(`‚úÖ Service ${ serviceName } reload initiated`);
                                    } catch (error) {
                                        console.error(`‚ùå Error reloading service ${ serviceName }: `, error);
                                    }
                                }, index * 500); // 500ms delay between each service
                            });
                            
                            // Also reload AI chatbot context
                            if (typeof initializeIntelligentAssistant === 'function') {
                                setTimeout(() => {
                                    console.log('ü§ñ Reloading AI assistant for location:', currentLocation);
                                    initializeIntelligentAssistant();
                                }, services.length * 500);
                            }
                            
                            // Show completion notification
                            setTimeout(() => {
                                showNotification(`‚úÖ ‡§∏‡§≠‡•Ä ‡§∏‡•á‡§µ‡§æ‡§è‡§Ç ${ currentLocation } ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã ‡§ó‡§à‡§Ç`, 'success');
                                console.log('üéâ All services reloaded successfully for location:', currentLocation);
                            }, (services.length + 1) * 500 + 1000);
                        }
        */
        */
        
        // Test function for debugging location updates
        function testLocationUpdate() {
            console.log('Testing location update...');
            console.log('Current location variables:', {
                currentLocation: currentLocation,
                currentLatitude: currentLatitude,
                currentLongitude: currentLongitude
            });
            
            // Test with Raebareli
            selectLocation('Raebareli', 26.2, 81.2);
        }
        
        // Make test function available globally
        window.testLocationUpdate = testLocationUpdate;
        
        // Force reload all services on page load
        /* COMMENTED OUT - Using enhanced_services.js instead
        /* COMMENTED OUT - Using enhanced_services.js instead
                        function forceReloadAllServices() {
                            console.log('Force reloading all services on page load');
                            reloadAllServices();
                        }
        */
        */
        
        // Auto-reload services every 5 minutes to keep data fresh
        setInterval(() => {
            console.log('Auto-reloading services to keep data fresh');
            reloadAllServices();
        }, 5 * 60 * 1000); // 5 minutes
        
        // Crop Search Functions
        let cropSearchTimeout;
        
        async function searchCrop(event) {
            const query = event.target.value.trim();
            
            // Clear previous timeout
            if (cropSearchTimeout) {
                clearTimeout(cropSearchTimeout);
            }
            
            if (query.length < 2) {
                hideCropSuggestions();
                return;
            }
            
            // Debounce search
            cropSearchTimeout = setTimeout(async () => {
                try {
                    const response = await fetch(`/ api / realtime - gov / crop_search /? crop = ${ encodeURIComponent(query) }& location=${ currentLocation }& latitude=${ currentLatitude }& longitude=${ currentLongitude } `);
                    const data = await response.json();
                    
                    if (data.comprehensive_analysis) {
                        showCropAnalysis(data);
                    } else if (data.available_crops) {
                        showCropSuggestions(data.available_crops.filter(crop => 
                            crop.toLowerCase().includes(query.toLowerCase())
                        ));
                    } else {
                        hideCropSuggestions();
                    }
                } catch (error) {
                    console.error('Crop search error:', error);
                    hideCropSuggestions();
                }
            }, 300);
        }
        
        function showCropSuggestions(crops = null) {
            const container = document.getElementById('cropSuggestions');
            
            if (crops) {
                container.innerHTML = crops.map(crop => `
            < div class="crop-suggestion" onclick = "selectCrop('${crop}')" >
                        <div>
                            <div class="crop-suggestion-name">${crop}</div>
                            <div class="crop-suggestion-details">Click to analyze</div>
                        </div>
                        <div class="crop-suggestion-details">üåæ</div>
                    </div >
            `).join('');
            }
            
            container.style.display = 'block';
        }
        
        function hideCropSuggestions() {
            const container = document.getElementById('cropSuggestions');
            container.style.display = 'none';
        }
        
        function selectCrop(cropName) {
            document.getElementById('cropSearchInput').value = cropName;
            hideCropSuggestions();
            searchSpecificCrop();
        }
        
        function searchSpecificCrop() {
            const cropName = document.getElementById('cropSearchInput').value.trim();
            if (cropName) {
                searchCrop({ target: { value: cropName } });
            }
        }
        
        function showCropAnalysis(data) {
            const container = document.getElementById('cropsData');
            const analysis = data.comprehensive_analysis;
            
            container.innerHTML = `
            < div class="real-time-header" >
                    <h4>üåæ ${analysis.crop_name} - ${data.location}</h4>
                    <p class="data-source">üìä ‡§∏‡•ç‡§∞‡•ã‡§§: ${data.data_source}</p>
                    <p class="timestamp">üïí ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§Ö‡§™‡§°‡•á‡§ü: ${new Date(data.timestamp).toLocaleString('hi-IN')}</p>
                </div >

            <div class="crop-analysis-container">
                <div class="crop-analysis-card">
                    <h5>üìä ‡§Æ‡•Ç‡§≤‡§≠‡•Ç‡§§ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä</h5>
                    <div class="analysis-grid">
                        <div class="analysis-item">
                            <strong>‡§Æ‡•å‡§∏‡§Æ:</strong> ${analysis.season}
                        </div>
                        <div class="analysis-item">
                            <strong>‡§Ö‡§µ‡§ß‡§ø:</strong> ${analysis.duration_days} ‡§¶‡§ø‡§®
                        </div>
                        <div class="analysis-item">
                            <strong>‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§®:</strong> ${analysis.yield_prediction}
                        </div>
                        <div class="analysis-item">
                            <strong>‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§≠‡§æ‡§µ:</strong> ${analysis.current_market_price}
                        </div>
                    </div>
                </div>

                <div class="crop-analysis-card">
                    <h5>üí∞ ‡§≤‡§æ‡§≠ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£</h5>
                    <div class="analysis-grid">
                        <div class="analysis-item">
                            <strong>‡§≤‡§æ‡§ó‡§§:</strong> ${analysis.input_cost}
                        </div>
                        <div class="analysis-item">
                            <strong>‡§Ü‡§Ø:</strong> ${analysis.revenue}
                        </div>
                        <div class="analysis-item">
                            <strong>‡§≤‡§æ‡§≠:</strong> ${analysis.profit}
                        </div>
                        <div class="analysis-item">
                            <strong>‡§≤‡§æ‡§≠ %:</strong> ${analysis.profit_percentage}
                        </div>
                    </div>
                </div>

                <div class="crop-analysis-card">
                    <h5>üå± ‡§ñ‡•á‡§§‡•Ä ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä</h5>
                    <div class="analysis-grid">
                        <div class="analysis-item">
                            <strong>‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä:</strong> ${analysis.soil_type}
                        </div>
                        <div class="analysis-item">
                            <strong>‡§™‡§æ‡§®‡•Ä:</strong> ${analysis.water_requirement}
                        </div>
                        <div class="analysis-item">
                            <strong>‡§§‡§æ‡§™‡§Æ‡§æ‡§®:</strong> ${analysis.temperature_range}
                        </div>
                        <div class="analysis-item">
                            <strong>‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ:</strong> ${analysis.government_support}
                        </div>
                    </div>
                </div>

                <div class="crop-analysis-card">
                    <h5>üìà ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø ‡§ï‡•Ä ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø‡§µ‡§æ‡§£‡•Ä</h5>
                    <div class="analysis-grid">
                        <div class="analysis-item">
                            <strong>‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø ‡§ï‡•Ä ‡§ï‡•Ä‡§Æ‡§§:</strong> ${analysis.future_price_prediction?.next_3_months || '‚Çπ2,500/quintal'}
                        </div>
                        <div class="analysis-item">
                            <strong>‡§Ö‡§ó‡§≤‡•á ‡§∏‡•Ä‡§ú‡§® ‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§®:</strong> ${analysis.yield_prediction_next_season?.predicted_yield || '40 quintals/hectare'}
                        </div>
                        <div class="analysis-item">
                            <strong>‡§Ö‡§ó‡§≤‡•á ‡§∏‡•Ä‡§ú‡§® ‡§≤‡§æ‡§≠:</strong> ${analysis.profit_prediction_next_season?.predicted_profit || '‚Çπ60,000/hectare'}
                        </div>
                        <div class="analysis-item">
                            <strong>‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§∏‡•ç‡§§‡§∞:</strong> ${analysis.risk_level}
                        </div>
                    </div>
                </div>
            </div>
        `;
            
            hideCropSuggestions();
        }

        // Mandi Selection and Crop Filtering Functions
        let selectedMandi = null;
        let currentMarketData = null;

        async function updatePricesForSelectedMandi() {
            const mandiDropdown = document.getElementById('mandiDropdown');
            if (!mandiDropdown || !mandiDropdown.value) return;
            
            selectedMandi = mandiDropdown.value;
            console.log('Selected Mandi:', selectedMandi);
            
            try {
                const container = document.getElementById('pricesData');
                container.innerHTML = '<div class="loading">‡§Æ‡§Ç‡§°‡•Ä ‡§ï‡•Ä ‡§ï‡•Ä‡§Æ‡§§‡•á‡§Ç ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à‡§Ç...</div>';
                
                const response = await fetch(`/ api / realtime - gov / market_prices /? location = ${ currentLocation }& latitude=${ currentLatitude }& longitude=${ currentLongitude }& mandi=${ encodeURIComponent(selectedMandi) } `);
                const data = await response.json();
                
                if (data.status === 'success' && data.crops && data.crops.length > 0) {
                    currentMarketData = data;
                    displayMandiPrices(data);
                } else {
                    container.innerHTML = '<div class="error">‡§á‡§∏ ‡§Æ‡§Ç‡§°‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•Ä‡§Æ‡§§ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à</div>';
                }
                
            } catch (error) {
                console.error('Error loading mandi prices:', error);
                document.getElementById('pricesData').innerHTML = '<div class="error">‡§Æ‡§Ç‡§°‡•Ä ‡§ï‡•Ä‡§Æ‡§§ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø</div>';
            }
        }

        function displayMandiPrices(data) {
            const container = document.getElementById('pricesData');
            container.innerHTML = `
            < div class="real-time-header" >
                    <h4>üí∞ ‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§≠‡§æ‡§µ - ${data.location}</h4>
                    <p class="data-source">üìä ‡§∏‡•ç‡§∞‡•ã‡§§: ${data.data_source || 'Ultra-Dynamic Government APIs'}</p>
                    <p class="timestamp">üïí ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§Ö‡§™‡§°‡•á‡§ü: ${new Date(data.timestamp).toLocaleString('hi-IN')}</p>
                </div >
                
                < !--Mandi Selection Section-- >
                <div class="mandi-search-container">
                    <h5>üè™ ‡§®‡§ø‡§ï‡§ü‡§§‡§Æ ‡§Æ‡§Ç‡§°‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç</h5>
                    <div class="mandi-selection-container">
                        <div class="mandi-dropdown-container">
                            <label for="mandiDropdown">üìç ‡§Æ‡§Ç‡§°‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç (‡§∏‡•ç‡§•‡§æ‡§® ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞)</label>
                            <select id="mandiDropdown" class="form-control mandi-dropdown" onchange="updatePricesForSelectedMandi()">
                                <option value="">‡§Æ‡§Ç‡§°‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç...</option>
                                ${data.nearest_mandis_data ? data.nearest_mandis_data.map(mandi => `
                                    <option value="${mandi.name}" ${mandi.name === selectedMandi ? 'selected' : ''}>
                                        ${mandi.name} ${mandi.auto_selected ? '(‡§®‡§ø‡§ï‡§ü‡§§‡§Æ)' : ''} - ${mandi.distance} - ${mandi.specialty}
                                    </option>
                                `).join('') : ''}
                            </select>
                            <div class="mandi-info-text">
                                <small class="text-muted">üìç ${data.location} ‡§ï‡•á ‡§®‡§ø‡§ï‡§ü‡§§‡§Æ ‡§Æ‡§Ç‡§°‡•Ä</small>
                            </div>
                        </div>
                        
                        <!-- Crop Filter Box -->
                        <div class="crop-filter-container">
                            <label for="cropFilter">üåæ ‡§´‡§∏‡§≤ ‡§´‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç</label>
                            <input type="text" id="cropFilter" placeholder="‡§´‡§∏‡§≤ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç (‡§ú‡•à‡§∏‡•á: ‡§ó‡•á‡§π‡•Ç‡§Ç, ‡§ö‡§æ‡§µ‡§≤)" class="form-control" onkeyup="filterCrops()">
                        </div>
                    </div>
                </div>
                
                <div class="mandi-prices-grid">
                    ${data.crops.map(crop => `
                        <div class="mandi-price-square">
                            <div class="square-header">
                                <h6>üåæ ${crop.name}</h6>
                                <span class="trend-icon">${crop.market_trend === 'Rising' ? 'üìà' : crop.market_trend === 'Falling' ? 'üìâ' : 'üìä'}</span>
                            </div>
                            <div class="square-content">
                                <div class="price-main">
                                    <span class="current-price">‚Çπ${crop.current_price?.toLocaleString('hi-IN') || '2,500'}</span>
                                    <span class="price-unit">/quintal</span>
                                </div>
                                <div class="price-details">
                                    <div class="detail-row">
                                        <span class="label">MSP:</span>
                                        <span class="value">‚Çπ${crop.msp?.toLocaleString('hi-IN') || '2,000'}</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="label">‡§≤‡§æ‡§≠:</span>
                                        <span class="value profit">‚Çπ${crop.profit_margin?.toLocaleString('hi-IN') || '500'}</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="label">%:</span>
                                        <span class="value profit-percent">${crop.profit_percentage || 25}%</span>
                                    </div>
                                </div>
                                <div class="mandi-info">
                                    <span class="mandi-name">${crop.mandi || 'Delhi Mandi'}</span>
                                    <span class="date">${crop.date || new Date().toLocaleDateString('hi-IN')}</span>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
        `;
        }

        function filterCrops() {
            const filterInput = document.getElementById('cropFilter');
            const cropCards = document.querySelectorAll('.mandi-price-square');
            
            if (!filterInput) return;
            
            const filterValue = filterInput.value.toLowerCase();
            
            cropCards.forEach(card => {
                const cropName = card.querySelector('h6').textContent.toLowerCase();
                if (cropName.includes(filterValue)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Setup service cards with proper event listeners
        /* COMMENTED OUT - Using enhanced_services.js instead
                function setupServiceCards() {
                    const serviceCards = document.querySelectorAll('.service-card');
                    console.log('üéØ Setting up', serviceCards.length, 'service cards');
                    
                    serviceCards.forEach((card, index) => {
                        // Add click event listener
                        card.addEventListener('click', function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            
                            // Get service name from onclick attribute
                            const onclickAttr = this.getAttribute('onclick');
                            const serviceName = onclickAttr?.match(/showService\('([^']+)'\)/)?.[1];
                            
                            if (serviceName) {
                                console.log('üéØ Service card clicked:', serviceName);
                                showService(serviceName);
                                
                                // Add visual feedback
                                this.style.transform = 'scale(0.95)';
                                setTimeout(() => {
                                    this.style.transform = '';
                                }, 150);
                            } else {
                                console.error('Service name not found for card:', this);
                            }
                        });
                        
                                </div>
                            </div>
                            
                            <div class="crop-analysis-card">
                                <h5>üìà ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø ‡§ï‡•Ä ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø‡§µ‡§æ‡§£‡•Ä</h5>
                                <div class="analysis-grid">
                                    <div class="analysis-item">
                                        <strong>‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø ‡§ï‡•Ä ‡§ï‡•Ä‡§Æ‡§§:</strong> ${analysis.future_price_prediction?.next_3_months || '‚Çπ2,500/quintal'}
                                    </div>
                                    <div class="analysis-item">
                                        <strong>‡§Ö‡§ó‡§≤‡•á ‡§∏‡•Ä‡§ú‡§® ‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§®:</strong> ${analysis.yield_prediction_next_season?.predicted_yield || '40 quintals/hectare'}
                                    </div>
                                    <div class="analysis-item">
                                        <strong>‡§Ö‡§ó‡§≤‡•á ‡§∏‡•Ä‡§ú‡§® ‡§≤‡§æ‡§≠:</strong> ${analysis.profit_prediction_next_season?.predicted_profit || '‚Çπ60,000/hectare'}
                                    </div>
                                    <div class="analysis-item">
                                        <strong>‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§∏‡•ç‡§§‡§∞:</strong> ${analysis.risk_level}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;

        hideCropSuggestions();
                }

        // Mandi Selection and Crop Filtering Functions
        let selectedMandi = null;
        let currentMarketData = null;

        async function updatePricesForSelectedMandi() {
            const mandiDropdown = document.getElementById('mandiDropdown');
            if (!mandiDropdown || !mandiDropdown.value) return;

            selectedMandi = mandiDropdown.value;
            console.log('Selected Mandi:', selectedMandi);

            try {
                const container = document.getElementById('pricesData');
                container.innerHTML = '<div class="loading">‡§Æ‡§Ç‡§°‡•Ä ‡§ï‡•Ä ‡§ï‡•Ä‡§Æ‡§§‡•á‡§Ç ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à‡§Ç...</div>';

                const response = await fetch(`/api/realtime-gov/market_prices/?location=${currentLocation}&latitude=${currentLatitude}&longitude=${currentLongitude}&mandi=${encodeURIComponent(selectedMandi)}`);
                const data = await response.json();

                if (data.status === 'success' && data.crops && data.crops.length > 0) {
                    currentMarketData = data;
                    displayMandiPrices(data);
                } else {
                    container.innerHTML = '<div class="error">‡§á‡§∏ ‡§Æ‡§Ç‡§°‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•Ä‡§Æ‡§§ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à</div>';
                }

            } catch (error) {
                console.error('Error loading mandi prices:', error);
                document.getElementById('pricesData').innerHTML = '<div class="error">‡§Æ‡§Ç‡§°‡•Ä ‡§ï‡•Ä‡§Æ‡§§ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø</div>';
            }
        }

        function displayMandiPrices(data) {
            const container = document.getElementById('pricesData');
            container.innerHTML = `
                        <div class="real-time-header">
                            <h4>üí∞ ‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§≠‡§æ‡§µ - ${data.location}</h4>
                            <p class="data-source">üìä ‡§∏‡•ç‡§∞‡•ã‡§§: ${data.data_source || 'Ultra-Dynamic Government APIs'}</p>
                            <p class="timestamp">üïí ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§Ö‡§™‡§°‡•á‡§ü: ${new Date(data.timestamp).toLocaleString('hi-IN')}</p>
                        </div>
                        
                        <!-- Mandi Selection Section -->
                        <div class="mandi-search-container">
                            <h5>üè™ ‡§®‡§ø‡§ï‡§ü‡§§‡§Æ ‡§Æ‡§Ç‡§°‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç</h5>
                            <div class="mandi-selection-container">
                                <div class="mandi-dropdown-container">
                                    <label for="mandiDropdown">üìç ‡§Æ‡§Ç‡§°‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç (‡§∏‡•ç‡§•‡§æ‡§® ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞)</label>
                                    <select id="mandiDropdown" class="form-control mandi-dropdown" onchange="updatePricesForSelectedMandi()">
                                        <option value="">‡§Æ‡§Ç‡§°‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç...</option>
                                        ${data.nearest_mandis_data ? data.nearest_mandis_data.map(mandi => `
                                            <option value="${mandi.name}" ${mandi.name === selectedMandi ? 'selected' : ''}>
                                                ${mandi.name} ${mandi.auto_selected ? '(‡§®‡§ø‡§ï‡§ü‡§§‡§Æ)' : ''} - ${mandi.distance} - ${mandi.specialty}
                                            </option>
                                        `).join('') : ''}
                                    </select>
                                    <div class="mandi-info-text">
                                        <small class="text-muted">üìç ${data.location} ‡§ï‡•á ‡§®‡§ø‡§ï‡§ü‡§§‡§Æ ‡§Æ‡§Ç‡§°‡•Ä</small>
                                    </div>
                                </div>
                                
                                <!-- Crop Filter Box -->
                                <div class="crop-filter-container">
                                    <label for="cropFilter">üåæ ‡§´‡§∏‡§≤ ‡§´‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç</label>
                                    <input type="text" id="cropFilter" placeholder="‡§´‡§∏‡§≤ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç (‡§ú‡•à‡§∏‡•á: ‡§ó‡•á‡§π‡•Ç‡§Ç, ‡§ö‡§æ‡§µ‡§≤)" class="form-control" onkeyup="filterCrops()">
                                </div>
                            </div>
                        </div>
                        
                        <div class="mandi-prices-grid">
                            ${data.crops.map(crop => `
                                <div class="mandi-price-square">
                                    <div class="square-header">
                                        <h6>üåæ ${crop.name}</h6>
                                        <span class="trend-icon">${crop.market_trend === 'Rising' ? 'üìà' : crop.market_trend === 'Falling' ? 'üìâ' : 'üìä'}</span>
                                    </div>
                                    <div class="square-content">
                                        <div class="price-main">
                                            <span class="current-price">‚Çπ${crop.current_price?.toLocaleString('hi-IN') || '2,500'}</span>
                                            <span class="price-unit">/quintal</span>
                                        </div>
                                        <div class="price-details">
                                            <div class="detail-row">
                                                <span class="label">MSP:</span>
                                                <span class="value">‚Çπ${crop.msp?.toLocaleString('hi-IN') || '2,000'}</span>
                                            </div>
                                            <div class="detail-row">
                                                <span class="label">‡§≤‡§æ‡§≠:</span>
                                                <span class="value profit">‚Çπ${crop.profit_margin?.toLocaleString('hi-IN') || '500'}</span>
                                            </div>
                                            <div class="detail-row">
                                                <span class="label">%:</span>
                                                <span class="value profit-percent">${crop.profit_percentage || 25}%</span>
                                            </div>
                                        </div>
                                        <div class="mandi-info">
                                            <span class="mandi-name">${crop.mandi || 'Delhi Mandi'}</span>
                                            <span class="date">${crop.date || new Date().toLocaleDateString('hi-IN')}</span>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
        }

        function filterCrops() {
            const filterInput = document.getElementById('cropFilter');
            const cropCards = document.querySelectorAll('.mandi-price-square');

            if (!filterInput) return;

            const filterValue = filterInput.value.toLowerCase();

            cropCards.forEach(card => {
                const cropName = card.querySelector('h6').textContent.toLowerCase();
                if (cropName.includes(filterValue)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Setup service cards with proper event listeners
        function setupServiceCards() {
            const serviceCards = document.querySelectorAll('.service-card');
            console.log('üéØ Setting up', serviceCards.length, 'service cards');

            serviceCards.forEach((card, index) => {
                // Add click event listener
                card.addEventListener('click', function (e) {
                    e.preventDefault();
                    e.stopPropagation();

                    // Get service name from onclick attribute
                    const onclickAttr = this.getAttribute('onclick');
                    const serviceName = onclickAttr?.match(/showService\('([^']+)'\)/)?.[1];

                    if (serviceName) {
                        console.log('üéØ Service card clicked:', serviceName);
                        showService(serviceName);

                        // Add visual feedback
                        this.style.transform = 'scale(0.95)';
                        setTimeout(() => {
                            this.style.transform = '';
                        }, 150);
                    } else {
                        console.error('Service name not found for card:', this);
                    }
                });

                console.log(`‚úÖ Service card ${index + 1} setup complete`);
            });
        }

        // Initialize
        /* COMMENTED OUT - Using enhanced_services.js DOMContentLoaded listener instead
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üåæ ‡§ï‡•É‡§∑‡§ø‡§Æ‡§ø‡§§‡•ç‡§∞ AI Frontend Loaded Successfully!');
                showNotification('‡§∏‡§≠‡•Ä ‡§∏‡•á‡§µ‡§æ‡§è‡§Ç ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•à‡§Ç!', 'success');
                
                // Setup service cards
                setupServiceCards();
                
                // Setup location search input event handler
                const locationInput = document.getElementById('locationSearchInput');
                if (locationInput) {
                    locationInput.addEventListener('input', searchLocations);
                    console.log('‚úÖ Location search input event handler set up');
                } else {
                    console.error('‚ùå Location search input not found');
                }
                
                // Load initial service data
                setTimeout(() => {
                    console.log('Loading initial service data...');
                    reloadAllServices();
                }, 1000);
        });
        */
    </script>

    <!-- Enhanced Services Script -->

    <!-- Complete Inline Service Loading Script - ALL FEATURES -->
    <script>
        (function () {
            console.log('üåæ Complete Service Loader Starting...');

            // Global variables
            let currentLocation = 'Delhi';
            let currentLatitude = 28.7041;
            let currentLongitude = 77.1025;
            let currentMandi = 'All Mandis';
            let locationSearchTimeout;

            // ========================================
            // LOCATION FUNCTIONS
            // ========================================

            function updateLocation(locationName, latitude, longitude) {
                currentLocation = locationName;
                currentLatitude = latitude;
                currentLongitude = longitude;

                console.log(`üìç Location updated to: ${locationName} (${latitude}, ${longitude})`);

                const locationDisplay = document.getElementById('currentLocationDisplay');
                if (locationDisplay) {
                    locationDisplay.textContent = locationName;
                }

                console.log('üîÑ Reloading all services for new location...');
                loadMarketPrices();
                loadWeatherData();
                loadGovernmentSchemes();
                loadCropRecommendations();
            }

            function searchLocations(event) {
                clearTimeout(locationSearchTimeout);

                const input = event.target;
                const query = input.value.trim();

                if (query.length < 2) {
                    hideLocationSuggestions();
                    return;
                }

                locationSearchTimeout = setTimeout(() => {
                    const indianCities = [
                        { name: 'Delhi', lat: 28.7041, lon: 77.1025 },
                        { name: 'Mumbai', lat: 19.0760, lon: 72.8777 },
                        { name: 'Bangalore', lat: 12.9716, lon: 77.5946 },
                        { name: 'Hyderabad', lat: 17.3850, lon: 78.4867 },
                        { name: 'Chennai', lat: 13.0827, lon: 80.2707 },
                        { name: 'Kolkata', lat: 22.5726, lon: 88.3639 },
                        { name: 'Pune', lat: 18.5204, lon: 73.8567 },
                        { name: 'Ahmedabad', lat: 23.0225, lon: 72.5714 },
                        { name: 'Jaipur', lat: 26.9124, lon: 75.7873 },
                        { name: 'Lucknow', lat: 26.8467, lon: 80.9462 },
                        { name: 'Chandigarh', lat: 30.7333, lon: 76.7794 },
                        { name: 'Indore', lat: 22.7196, lon: 75.8577 },
                        { name: 'Bhopal', lat: 23.2599, lon: 77.4126 },
                        { name: 'Patna', lat: 25.5941, lon: 85.1376 },
                        { name: 'Nagpur', lat: 21.1458, lon: 79.0882 }
                    ];

                    const filtered = indianCities.filter(city =>
                        city.name.toLowerCase().includes(query.toLowerCase())
                    );

                    showLocationSuggestions(filtered);
                }, 300);
            }

            function showLocationSuggestions(suggestions) {
                const container = document.getElementById('locationSuggestions');
                if (!container || !suggestions) return;

                if (suggestions.length === 0) {
                    container.style.display = 'none';
                    return;
                }

                let html = '';
                suggestions.forEach(location => {
                    html += `
                    <div class="location-suggestion" onclick="selectLocation('${location.name}', ${location.lat}, ${location.lon})">
                        üìç ${location.name}
                    </div>
                `;
                });

                container.innerHTML = html;
                container.style.display = 'block';
            }

            function hideLocationSuggestions() {
                const container = document.getElementById('locationSuggestions');
                if (container) {
                    container.style.display = 'none';
                }
            }

            function selectLocation(locationName, latitude, longitude) {
                const input = document.getElementById('locationSearchInput');
                if (input) {
                    input.value = locationName;
                }

                hideLocationSuggestions();
                updateLocation(locationName, latitude, longitude);
            }

            function searchCurrentLocation() {
                const input = document.getElementById('locationSearchInput');
                if (input && input.value.trim()) {
                    const event = new Event('keyup');
                    input.dispatchEvent(event);
                }
            }

            function detectLocation() {
                if (!navigator.geolocation) {
                    alert('Geolocation is not supported by your browser');
                    return;
                }

                console.log('üåç Detecting location...');

                navigator.geolocation.getCurrentPosition(
                    position => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;

                        console.log(`üìç Detected coordinates: ${lat}, ${lon}`);

                        // Fetch location name using Reverse Geocoding
                        fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`)
                            .then(response => response.json())
                            .then(data => {
                                console.log('üìç Reverse geocoding result:', data);
                                const address = data.address;
                                // Try to find the most relevant location name
                                const locationName = address.city || address.town || address.village || address.suburb || address.county || 'Detected Location';

                                console.log(`üìç Resolved location name: ${locationName}`);
                                updateLocation(locationName, lat, lon);
                            })
                            .catch(error => {
                                console.error('‚ùå Error fetching location name:', error);
                                updateLocation('Detected Location', lat, lon);
                            });
                    },
                    error => {
                        console.error('Geolocation error:', error);
                        alert('Unable to detect location. Please search manually.');
                    }
                );
            }

            // ========================================
            // SERVICE NAVIGATION
            // ========================================

            function showService(serviceName) {
                const sections = document.querySelectorAll('.content-section');
                sections.forEach(section => {
                    section.style.display = 'none';
                });

                const targetSection = document.getElementById(serviceName + '-content');
                if (targetSection) {
                    targetSection.style.display = 'block';
                    targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }

            function setupServiceCards() {
                const serviceCards = document.querySelectorAll('.service-card, [onclick*="showService"]');
                serviceCards.forEach((card, index) => {
                    const onclickAttr = card.getAttribute('onclick');
                    if (onclickAttr) {
                        const match = onclickAttr.match(/showService\('([^']+)'\)/);
                        if (match) {
                            const serviceName = match[1];
                            card.onclick = function (e) {
                                e.preventDefault();
                                showService(serviceName);
                            };
                        }
                    }
                });
                console.log('‚úÖ Service cards setup complete');
            }

            // ========================================
            // DATA LOADING FUNCTIONS
            // ========================================

            async function loadMarketPrices() {
                try {
                    const container = document.getElementById('pricesData');
                    if (!container) return;

                    container.innerHTML = '<div class="loading">‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§≠‡§æ‡§µ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...</div>';

                    const response = await fetch(`/api/market-prices/?location=${currentLocation}&latitude=${currentLatitude}&longitude=${currentLongitude}&v=v2.0`);
                    const data = await response.json();

                    console.log('Market data:', data);

                    const crops = data.crops || data.market_prices?.top_crops || [];
                    const nearbyMandis = data.nearby_mandis || data.market_prices?.nearby_mandis || [];

                    if (crops && crops.length > 0) {
                        let html = `
                        <div class="real-time-header" style="margin-bottom: 20px;">
                            <h4 style="color: #2d5016;">üí∞ ‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§≠‡§æ‡§µ - ${data.location}</h4>
                            <p style="color: #666; margin: 5px 0;">üìä ‡§∏‡•ç‡§∞‡•ã‡§§: ${data.data_source || 'Agmarknet + e-NAM'}</p>
                            <p style="color: #666; margin: 5px 0;">üè™ ‡§Æ‡§Ç‡§°‡•Ä: ${currentMandi}</p>
                            <p style="color: #666; margin: 5px 0;">üïí ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§Ö‡§™‡§°‡•á‡§ü: ${new Date(data.timestamp || Date.now()).toLocaleString('hi-IN')}</p>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
                    `;

                        crops.forEach(crop => {
                            const profitColor = crop.profit >= 0 ? '#28a745' : '#dc3545';
                            const trendIcon = crop.trend === '‡§¨‡§¢‡§º ‡§∞‡§π‡§æ' ? 'üìà' : crop.trend === '‡§ó‡§ø‡§∞ ‡§∞‡§π‡§æ' ? 'üìâ' : 'üìä';
                            html += `
                            <div style="background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); transition: transform 0.3s;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <h6 style="margin: 0; color: #2d5016; font-weight: 700;">üåæ ${crop.crop_name_hindi || crop.crop_name}</h6>
                                    <span style="font-size: 1.2rem;">${trendIcon}</span>
                                </div>
                                <div style="text-align: center; margin-bottom: 15px;">
                                    <div style="font-size: 1.8rem; font-weight: 700; color: #4a7c59;">‚Çπ${crop.current_price.toLocaleString('hi-IN')}</div>
                                    <div style="color: #666; font-size: 0.9rem;">/quintal</div>
                                </div>
                                <div style="font-size: 0.9rem; line-height: 1.8;">
                                    <div style="display: flex; justify-content: space-between;">
                                        <span style="color: #666;">MSP:</span>
                                        <span style="font-weight: 600;">‚Çπ${crop.msp.toLocaleString('hi-IN')}</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between;">
                                        <span style="color: #666;">‡§≤‡§æ‡§≠:</span>
                                        <span style="font-weight: 600; color: ${profitColor};">‚Çπ${crop.profit.toLocaleString('hi-IN')}</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between;">
                                        <span style="color: #666;">‡§Æ‡§æ‡§Ç‡§ó:</span>
                                        <span style="font-weight: 600;">${crop.demand || '‡§Æ‡§ß‡•ç‡§Ø‡§Æ'}</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between;">
                                        <span style="color: #666;">‡§Ü‡§™‡•Ç‡§∞‡•ç‡§§‡§ø:</span>
                                        <span style="font-weight: 600;">${crop.supply || '‡§Æ‡§ß‡•ç‡§Ø‡§Æ'}</span>
                                    </div>
                                </div>
                            </div>
                        `;
                        });

                        html += '</div>';

                        if (nearbyMandis && nearbyMandis.length > 0) {
                            html += `
                            <div style="margin-top: 30px;">
                                <h5 style="color: #2d5016; margin-bottom: 15px;">üè™ ‡§®‡§ø‡§ï‡§ü‡§§‡§Æ ‡§Æ‡§Ç‡§°‡•Ä (‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç ‡§ö‡§Ø‡§® ‡§ï‡•á ‡§≤‡§ø‡§è)</h5>
                                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">
                        `;

                            nearbyMandis.forEach(mandi => {
                                const statusColor = mandi.status === '‡§ñ‡•Å‡§≤‡§æ' ? '#28a745' : '#dc3545';
                                const isSelected = currentMandi === mandi.name;
                                const borderStyle = isSelected ? 'border: 3px solid #4a7c59;' : 'border: 1px solid #ddd;';
                                html += `
                                <div style="background: ${isSelected ? '#f0f8f0' : '#f8f9fa'}; border-radius: 10px; padding: 15px; ${borderStyle} cursor: pointer; transition: all 0.3s;" 
                                     onclick="selectMandi('${mandi.name}')"
                                     onmouseover="this.style.transform='scale(1.05)'"
                                     onmouseout="this.style.transform='scale(1)'">
                                    <div style="font-weight: 700; color: #2d5016; margin-bottom: 5px;">${mandi.name} ${isSelected ? '‚úì' : ''}</div>
                                    <div style="font-size: 0.85rem; color: #666;">üìç ${mandi.distance}</div>
                                    <div style="font-size: 0.85rem; color: #666;">üè∑Ô∏è ${mandi.specialty}</div>
                                    <div style="font-size: 0.85rem; color: ${statusColor}; font-weight: 600;">${mandi.status}</div>
                                </div>
                            `;
                            });

                            html += '</div></div>';
                        }

                        container.innerHTML = html;
                        console.log('‚úÖ Market prices loaded:', crops.length, 'crops,', nearbyMandis.length, 'mandis');
                    } else {
                        container.innerHTML = '<div style="padding: 20px; text-align: center;">‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§≠‡§æ‡§µ ‡§°‡•á‡§ü‡§æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à</div>';
                    }
                } catch (error) {
                    console.error('Market prices error:', error);
                    const container = document.getElementById('pricesData');
                    if (container) container.innerHTML = '<div style="padding: 20px; text-align: center; color: #dc3545;">‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§≠‡§æ‡§µ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø</div>';
                }
            }

            function selectMandi(mandiName) {
                console.log('üè™ Selected mandi:', mandiName);
                currentMandi = mandiName;
                loadMarketPrices();
            }

            async function loadWeatherData() {
                try {
                    const container = document.getElementById('weatherData');
                    if (!container) return;

                    container.innerHTML = '<div class="loading">‡§Æ‡•å‡§∏‡§Æ ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</div>';

                    const response = await fetch(`/api/weather/?location=${currentLocation}&latitude=${currentLatitude}&longitude=${currentLongitude}`);
                    const data = await response.json();

                    console.log('Weather data:', data);

                    const weather = data.current_weather || {};
                    const forecast = data.forecast_7_days || [];

                    if (weather && data.location) {
                        let html = `
                        <div style="background: white; border-radius: 15px; padding: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px;">
                            <h4 style="color: #2d5016; margin-bottom: 20px;">üå§Ô∏è ‡§Æ‡•å‡§∏‡§Æ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä - ${data.location}</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                                <div style="text-align: center;">
                                    <div style="font-size: 3rem; font-weight: 700; color: #4a7c59;">${weather.temperature || '28¬∞C'}</div>
                                    <div style="color: #666; margin-top: 10px;">${weather.condition || weather.description || '‡§∏‡§æ‡§´ ‡§Ü‡§∏‡§Æ‡§æ‡§®'}</div>
                                </div>
                                <div>
                                    <div style="margin-bottom: 10px;">üíß ‡§®‡§Æ‡•Ä: ${weather.humidity || '65%'}</div>
                                    <div style="margin-bottom: 10px;">üí® ‡§π‡§µ‡§æ: ${weather.wind_speed || '12 km/h'}</div>
                                    <div style="margin-bottom: 10px;">üå°Ô∏è ‡§Ö‡§®‡•Å‡§≠‡§µ: ${weather.feels_like || '30¬∞C'}</div>
                                    <div style="margin-bottom: 10px;">üìä ‡§¶‡§¨‡§æ‡§µ: ${weather.pressure || '1013'} ${weather.pressure_unit || 'hPa'}</div>
                                </div>
                            </div>
                        </div>
                    `;

                        if (forecast && forecast.length > 0) {
                            html += `
                            <div style="background: white; border-radius: 15px; padding: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                                <h5 style="color: #2d5016; margin-bottom: 15px;">üìÖ 7 ‡§¶‡§ø‡§® ‡§ï‡§æ ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§®‡•Å‡§Æ‡§æ‡§®</h5>
                                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px;">
                        `;

                            forecast.slice(0, 7).forEach(day => {
                                html += `
                                <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; text-align: center;">
                                    <div style="font-weight: 700; color: #2d5016; margin-bottom: 5px;">${day.day || day.date}</div>
                                    <div style="font-size: 1.5rem; color: #4a7c59; margin: 10px 0;">${day.temperature || '28¬∞C'}</div>
                                    <div style="font-size: 0.85rem; color: #666;">${day.condition || '‡§∏‡§æ‡§´'}</div>
                                </div>
                            `;
                            });

                            html += '</div></div>';
                        }

                        container.innerHTML = html;
                        console.log('‚úÖ Weather loaded with', forecast.length, 'day forecast');
                    } else {
                        container.innerHTML = '<div style="padding: 20px; text-align: center;">‡§Æ‡•å‡§∏‡§Æ ‡§°‡•á‡§ü‡§æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à</div>';
                    }
                } catch (error) {
                    console.error('Weather error:', error);
                    const container = document.getElementById('weatherData');
                    if (container) container.innerHTML = '<div style="padding: 20px; text-align: center; color: #dc3545;">‡§Æ‡•å‡§∏‡§Æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø</div>';
                }
            }

            async function loadGovernmentSchemes() {
                try {
                    const container = document.getElementById('schemesData');
                    if (!container) return;

                    container.innerHTML = '<div class="loading">‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à‡§Ç...</div>';

                    const response = await fetch(`/api/government-schemes/?location=${currentLocation}`);
                    const data = await response.json();

                    console.log('Schemes data:', data);

                    const schemes = data.schemes || [];

                    if (schemes && schemes.length > 0) {
                        let html = '<div style="display: grid; gap: 20px;">';

                        schemes.forEach(scheme => {
                            // FIXED: Make schemes clickable with official website link
                            const officialUrl = scheme.official_website || scheme.apply_url || `https://www.google.com/search?q=${encodeURIComponent(scheme.name + ' official website')}`;
                            html += `
                            <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-left: 5px solid #4a7c59; cursor: pointer; transition: transform 0.3s;"
                                 onclick="window.open('${officialUrl}', '_blank')"
                                 onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 25px rgba(0,0,0,0.15)'"
                                 onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.1)'">
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <h5 style="color: #2d5016; margin-bottom: 15px;">üìã ${scheme.name_hindi || scheme.name}</h5>
                                    <span style="color: #4a7c59; font-size: 1.5rem;">üîó</span>
                                </div>
                                <p style="color: #666; margin-bottom: 15px; line-height: 1.6;">${scheme.description_hindi || scheme.description || ''}</p>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                                    <div>
                                        <strong style="color: #2d5016;">üí∞ ‡§≤‡§æ‡§≠:</strong>
                                        <div style="color: #666; font-size: 0.9rem; margin-top: 5px;">${scheme.benefits_hindi || scheme.benefits || '‡§µ‡§ø‡§µ‡§∞‡§£ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç'}</div>
                                    </div>
                                    <div>
                                        <strong style="color: #2d5016;">‚úÖ ‡§™‡§æ‡§§‡•ç‡§∞‡§§‡§æ:</strong>
                                        <div style="color: #666; font-size: 0.9rem; margin-top: 5px;">${scheme.eligibility_hindi || scheme.eligibility || '‡§∏‡§≠‡•Ä ‡§ï‡§ø‡§∏‡§æ‡§®'}</div>
                                    </div>
                                </div>
                                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; color: #4a7c59; font-size: 0.9rem; font-weight: 600;">
                                    üëÜ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç ‡§Ü‡§ß‡§ø‡§ï‡§æ‡§∞‡§ø‡§ï ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü ‡§™‡§∞ ‡§ú‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è
                                </div>
                            </div>
                        `;
                        });

                        html += '</div>';
                        container.innerHTML = html;
                        console.log('‚úÖ Schemes loaded:', schemes.length, 'schemes');
                    } else {
                        container.innerHTML = '<div style="padding: 20px; text-align: center;">‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡§Ç</div>';
                    }
                } catch (error) {
                    console.error('Schemes error:', error);
                    const container = document.getElementById('schemesData');
                    if (container) container.innerHTML = '<div style="padding: 20px; text-align: center; color: #dc3545;">‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø</div>';
                }
            }

            async function loadCropRecommendations() {
                try {
                    const container = document.getElementById('cropsData');
                    if (!container) return;

                    container.innerHTML = '<div class="loading">‡§´‡§∏‡§≤ ‡§∏‡•Å‡§ù‡§æ‡§µ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...</div>';

                    const response = await fetch(`/api/advisories/?location=${currentLocation}`);
                    const data = await response.json();

                    console.log('Crops data:', data);

                    const recommendations = data.recommendations || [];

                    // Helper for category icons
                    const getCategoryIcon = (category) => {
                        const icons = {
                            'Cereal': 'üåæ', 'Pulse': 'ü´ò', 'Oilseed': 'üåª', 'Vegetable': 'ü•¶',
                            'Fruit': 'üçé', 'Spice': 'üå∂Ô∏è', 'Commercial': 'üí∞', 'Medicinal': 'üåø'
                        };
                        return icons[category] || 'üå±';
                    };

                    // Helper for water requirement color
                    const getWaterColor = (req) => {
                        if (req === 'high') return '#007bff'; // Blue
                        if (req === 'moderate') return '#28a745'; // Green
                        return '#fd7e14'; // Orange for low
                    };

                    if (recommendations && recommendations.length > 0) {
                        let html = `
                        <div class="real-time-header" style="background: linear-gradient(135deg, #2d5016 0%, #4a7c59 100%); margin-bottom: 25px;">
                            <h4 style="color: white; margin-bottom: 10px;">${data.season} ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§∞‡•ç‡§µ‡•ã‡§§‡•ç‡§§‡§Æ ‡§´‡§∏‡§≤ ‡§∏‡•Å‡§ù‡§æ‡§µ - ${data.region}</h4>
                            <p style="color: rgba(255,255,255,0.9); margin: 5px 0;">üìä ‡§∏‡•ç‡§∞‡•ã‡§§: ${data.data_source}</p>
                            <p style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">${data.message}</p>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px;">
                    `;

                        recommendations.forEach(crop => {
                            const suitabilityColor = crop.suitability_score >= 85 ? '#28a745' : crop.suitability_score >= 70 ? '#ffc107' : '#dc3545';
                            const categoryIcon = getCategoryIcon(crop.category);
                            const waterColor = getWaterColor(crop.water_requirement);

                            html += `
                            <div style="background: white; border-radius: 15px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); transition: transform 0.3s; position: relative; overflow: hidden; border-top: 4px solid ${suitabilityColor};">
                                <div style="position: absolute; top: 10px; right: 10px; background: #f8f9fa; padding: 5px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: 700; color: #333; border: 1px solid #ddd;">
                                    ${categoryIcon} ${crop.category}
                                </div>
                                
                                <h5 style="color: #2d5016; font-weight: 700; margin-bottom: 5px; font-size: 1.25rem;">${crop.crop_name_hindi}</h5>
                                <div style="color: #444; font-size: 0.9rem; margin-bottom: 15px; font-weight: 500;">${crop.crop_name}</div>
                                
                                <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                    <div style="flex-grow: 1; height: 8px; background: #eee; border-radius: 4px; overflow: hidden;">
                                        <div style="width: ${crop.suitability_score}%; height: 100%; background: ${suitabilityColor}; border-radius: 4px;"></div>
                                    </div>
                                    <span style="margin-left: 10px; font-weight: 700; color: ${suitabilityColor};">${crop.suitability_score}%</span>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9rem; background: #f8f9fa; padding: 10px; border-radius: 10px; mb-3; border: 1px solid #eee;">
                                    <div>
                                        <div style="color: #444; font-size: 0.85rem; font-weight: 600;">‡§Ö‡§®‡•Å‡§Æ‡§æ‡§®‡§ø‡§§ ‡§≤‡§æ‡§≠</div>
                                        <div style="font-weight: 700; color: #28a745; font-size: 1rem;">‚Çπ${crop.profit_per_hectare.toLocaleString('hi-IN')}</div>
                                    </div>
                                    <div>
                                        <div style="color: #444; font-size: 0.85rem; font-weight: 600;">‡§â‡§™‡§ú (‡§ï‡•ç‡§µ‡§ø‡§Ç‡§ü‡§≤/‡§π‡•á.)</div>
                                        <div style="font-weight: 700; color: #2d5016; font-size: 1rem;">${crop.yield_per_hectare} Q</div>
                                    </div>
                                    <div>
                                        <div style="color: #444; font-size: 0.85rem; font-weight: 600;">‡§Ö‡§µ‡§ß‡§ø</div>
                                        <div style="font-weight: 600; color: #333;">${crop.duration_days} ‡§¶‡§ø‡§®</div>
                                    </div>
                                     <div>
                                        <div style="color: #444; font-size: 0.85rem; font-weight: 600;">‡§™‡§æ‡§®‡•Ä ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ</div>
                                        <div style="font-weight: 600; color: ${waterColor}; text-transform: capitalize;">${crop.water_requirement}</div>
                                    </div>
                                </div>
                                
                                <div style="margin-top: 15px; font-size: 0.9rem; color: #222; background: #fff3cd; padding: 10px; border-radius: 8px; border-left: 3px solid #ffc107;">
                                    üí° <strong>‡§∏‡•Å‡§ù‡§æ‡§µ:</strong> ${crop.reason_hindi}
                                </div>
                            </div>
                        `;
                        });

                        html += '</div>';
                        container.innerHTML = html;
                        console.log('‚úÖ Crops loaded:', recommendations.length, 'recommendations');
                    } else {
                        container.innerHTML = '<div style="padding: 20px; text-align: center;">‡§´‡§∏‡§≤ ‡§∏‡•Å‡§ù‡§æ‡§µ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡§Ç</div>';
                    }
                } catch (error) {
                    console.error('Crops error:', error);
                    const container = document.getElementById('cropsData');
                    if (container) container.innerHTML = '<div style="padding: 20px; text-align: center; color: #dc3545;">‡§´‡§∏‡§≤ ‡§∏‡•Å‡§ù‡§æ‡§µ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø</div>';
                }
            }

            // ========================================
            // KRISHI RAKSHA 2.0 DIAGNOSTICS
            // ========================================
            async function runKrishiRakshaDiagnosis() {
                const cropSelect = document.getElementById('krCropSelect');
                const resultsContainer = document.getElementById('krishiRakshaResults');

                const crop = cropSelect.value;
                if (!crop) {
                    alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§´‡§∏‡§≤ ‡§ö‡•Å‡§®‡•á‡§Ç / Please select a crop first');
                    return;
                }

                // Show loading state
                resultsContainer.style.display = 'block';
                resultsContainer.innerHTML = `
                    <div class="text-center p-5">
                        <i class="fas fa-spinner fa-spin fa-3x text-success"></i>
                        <h4 class="mt-3">Analyzing ${crop.charAt(0).toUpperCase() + crop.slice(1)}...</h4>
                        <p>Running Dual AI Pipeline ‚Ä¢ Verifying with Weather Data...</p>
                    </div>
                `;

                try {
                    const response = await fetch('/api/diagnostics/detect/', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            crop: crop,
                            location: currentLocation,
                            images: {},
                            session_id: 'kr_' + Date.now()
                        })
                    });

                    const data = await response.json();
                    console.log('KrishiRaksha Response:', data);

                    if (data.status === 'success') {
                        displayKrishiRakshaResults(data);
                    } else {
                        resultsContainer.innerHTML = `
                            <div class="alert alert-danger">
                                <i class="fas fa-exclamation-triangle"></i> ${data.message || 'Diagnosis failed'}
                            </div>
                        `;
                    }
                } catch (error) {
                    console.error('KrishiRaksha Error:', error);
                    resultsContainer.innerHTML = `
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle"></i> Error connecting to diagnostic service
                        </div>
                    `;
                }
            }

            function displayKrishiRakshaResults(data) {
                const resultsContainer = document.getElementById('krishiRakshaResults');
                const diagnoses = data.diagnosis || [];

                let html = `
                    <div class="real-time-header">
                        <h4>ü©∫ Diagnostic Report: ${data.crop_detected.charAt(0).toUpperCase() + data.crop_detected.slice(1)}</h4>
                        <p class="data-source">üìç Location: ${data.location}</p>
                        <p class="timestamp">üïí ${new Date(data.timestamp).toLocaleString('hi-IN')}</p>
                    </div>

                    <div class="row g-4 mt-3">
                `;

                diagnoses.forEach((d, idx) => {
                    const severityColor = d.severity_label === 'High' ? '#dc3545' : (d.severity_label === 'Medium' ? '#ffc107' : '#28a745');
                    const confidencePercent = Math.round(d.confidence * 100);

                    html += `
                        <div class="col-md-6">
                            <div class="card shadow-sm h-100" style="border-left: 4px solid ${severityColor};">
                                <div class="card-header bg-light">
                                    <h5 class="mb-0" style="color: #2d5016; font-weight: 700;">${d.name}</h5>
                                    <small style="color: #444; font-weight: 600;">Rank #${idx + 1}</small>
                                </div>
                                <div class="card-body">
                                    <!-- Confidence -->
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between mb-1">
                                            <span style="color: #333;"><strong>Confidence:</strong></span>
                                            <span class="badge bg-primary">${confidencePercent}%</span>
                                        </div>
                                        <div class="progress" style="height: 8px;">
                                            <div class="progress-bar bg-primary" style="width: ${confidencePercent}%"></div>
                                        </div>
                                    </div>

                                    <!-- Severity -->
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between mb-1">
                                            <span style="color: #333;"><strong>Severity:</strong></span>
                                            <span class="badge" style="background-color: ${severityColor}; color: white;">${d.severity_label} (${d.severity_score}%)</span>
                                        </div>
                                        <div class="progress" style="height: 8px;">
                                            <div class="progress-bar" style="width: ${d.severity_score}%; background-color: ${severityColor};"></div>
                                        </div>
                                    </div>

                                    <!-- Symptoms -->
                                    <div class="mb-3">
                                        <strong style="color: #2d5016;">Symptoms:</strong>
                                        <ul class="mb-0 mt-1" style="color: #333;">
                                            ${d.symptoms.map(s => `<li>${s}</li>`).join('')}
                                        </ul>
                                    </div>

                                    <!-- Treatment -->
                                    <div class="mb-2">
                                        <strong style="color: #2d5016;">Treatment:</strong>
                                        <ul class="mb-0 mt-1" style="color: #333;">
                                            ${d.treatment.map(t => `<li>${t}</li>`).join('')}
                                        </ul>
                                    </div>

                                    ${d.verification_note ? `
                                        <div class="alert alert-info py-2 px-3 mt-3 mb-0" style="background-color: #d1ecf1; border-color: #bee5eb; color: #0c5460;">
                                            <small><i class="fas fa-info-circle"></i> ${d.verification_note}</small>
                                        </div>
                                    ` : ''}

                                    ${d.explanation ? `
                                        <div class="alert alert-secondary py-2 px-3 mt-2 mb-0" style="background-color: #e2e3e5; border-color: #d6d8db; color: #383d41;">
                                            <small><strong>Explanation:</strong> ${d.explanation}</small>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += `
                    </div>

                    <!-- Feedback Section -->
                    <div class="card mt-4 shadow-sm">
                        <div class="card-header bg-warning text-dark">
                            <h5 class="mb-0"><i class="fas fa-comment-dots"></i> Was this diagnosis helpful?</h5>
                        </div>
                        <div class="card-body text-center">
                            <button class="btn btn-success me-2" onclick="submitKRFeedback(true)">
                                <i class="fas fa-thumbs-up"></i> Yes, Accurate
                            </button>
                            <button class="btn btn-danger" onclick="submitKRFeedback(false)">
                                <i class="fas fa-thumbs-down"></i> No, Incorrect
                            </button>
                        </div>
                    </div>
                `;

                resultsContainer.innerHTML = html;
            }

            async function submitKRFeedback(isCorrect) {
                try {
                    await fetch('/api/diagnostics/feedback/', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            session_id: 'kr_' + Date.now(),
                            is_correct: isCorrect
                        })
                    });
                    alert(isCorrect ? '‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! Feedback recorded.' : 'Thank you. We will improve our model.');
                } catch (error) {
                    console.error('Feedback error:', error);
                }
            }

            // ========================================
            // MAKE FUNCTIONS GLOBALLY AVAILABLE
            // ========================================
            window.updateLocation = updateLocation;
            window.searchLocations = searchLocations;
            window.showLocationSuggestions = showLocationSuggestions;
            window.selectLocation = selectLocation;
            window.searchCurrentLocation = searchCurrentLocation;
            window.detectLocation = detectLocation;
            window.selectMandi = selectMandi;
            window.showService = showService;
            window.loadMarketPrices = loadMarketPrices;
            window.loadWeatherData = loadWeatherData;
            window.loadGovernmentSchemes = loadGovernmentSchemes;
            window.loadCropRecommendations = loadCropRecommendations;
            window.runKrishiRakshaDiagnosis = runKrishiRakshaDiagnosis;
            window.submitKRFeedback = submitKRFeedback;

            // ========================================
            // AUTO-INITIALIZE
            // ========================================
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function () {
                    console.log('üìä Page loaded, initializing...');
                    setupServiceCards();
                    setTimeout(() => {
                        loadMarketPrices();
                        loadWeatherData();
                        loadGovernmentSchemes();
                        loadCropRecommendations();
                    }, 500);
                });
            } else {
                console.log('üìä Page already loaded, initializing...');
                setupServiceCards();
                setTimeout(() => {
                    loadMarketPrices();
                    loadWeatherData();
                    loadGovernmentSchemes();
                    loadCropRecommendations();
                }, 500);
            }
        })();
    </script>

</body>

</html>